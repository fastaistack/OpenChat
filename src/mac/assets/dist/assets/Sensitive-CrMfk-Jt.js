import{S as j,ah as P,P as S,f as V,e as o,r as L,c as C,o as h,a as l,m as O,l as I,t as p,b as i,d as b,x as E,w as U,j as M,s as F}from"./index-B9s1B9jQ.js";import{_ as K,s as R}from"./_plugin-vue_export-helper-D8ncxyMm.js";import{a as Y}from"./inputnumber.esm-CIhko8if.js";import{a as z}from"./slider.esm-BAPKB8wQ.js";import{c as G,a as d,u as H}from"./vee-validate-Ce0Yf3uk.js";import{g as J}from"./Markdown-CsFcuW9P.js";import{u as Q}from"./dayjs.min-BF7iIa5r.js";function W(_){return j({method:"get",url:"/plugin-param/sensitive/list",params:_})}function X(_){return j({method:"put",url:`/plugin-param/sensitive/update/${_.session_id}`,data:_})}const Z={class:"sensitive flex flex-col w-full items-center space-y-4"},ee={class:"w-full"},te={class:"flex items-center mb-2"},le={for:"baidu_api",class:"ml-2 font-semibold labels-item"},ae={key:0,class:"pl-6 pr-2 py-2 space-y-2 tabs-item"},ie={class:"space-y-1"},oe={for:"baiduApiIntervalTokens",class:"font-semibold text-slate-500 dark:text-slate-400"},se={class:"w-full flex flex-col items-start justify-start"},ne={class:"w-full flex flex-row items-center justify-start gap-4"},re={class:"text-red-600"},de={class:"space-y-1"},_e={for:"baiduApiIntervalTokens",class:"font-semibold text-slate-500 dark:text-slate-400"},ce={class:"w-full flex flex-col items-start justify-start"},ue={class:"text-red-600"},me={class:"space-y-1"},pe={class:"w-full flex flex-col items-start justify-start"},fe={class:"text-red-600"},ve={__name:"Sensitive",props:{pluginId:{type:[String,Number],default:0},initParams:{type:Object,default:()=>null},isSettingDefault:{type:Boolean,default:!1}},setup(_,{expose:T}){const $=P(),k=Q(),n=_,s=S({local_words:!1,baidu_api:!0,local_model:!1}),q=V(()=>G({baidu_api_interval_tokens:s.baidu_api?d().required(o("lang.noEmpty")):d(),baidu_api_api_key:s.baidu_api?d().required(o("lang.noEmpty")):null,baidu_api_secret_key:s.baidu_api?d().required(o("lang.noEmpty")):null,local_model_model_id:s.local_model?d().required(o("lang.noEmpty")):null,local_model_interval_tokens:s.local_model?d().required(o("lang.noEmpty")):d()})),{defineField:c,handleSubmit:w,errors:f}=H({validationSchema:q,initialValues:{local_word_interval_tokens:10,baidu_api_interval_tokens:20,baidu_api_api_key:"",baidu_api_secret_key:"",local_model_model_id:null,local_model_interval_tokens:20,local_model_filter_model_list:[]}}),t=S({local_words:{open:!1,form:{interval_tokens:c("local_word_interval_tokens")[0]}},baidu_api:{open:!0,form:{interval_tokens:c("baidu_api_interval_tokens")[0],api_key:c("baidu_api_api_key")[0],secret_key:c("baidu_api_secret_key")[0]}},local_model:{open:!1,form:{model_id:c("local_model_model_id")[0],interval_tokens:c("local_model_interval_tokens")[0],filter_model_list:[{name:o("lang.politic"),type:"politic",active:!0,threshold:.8},{name:o("lang.porn"),type:"porn",active:!0,threshold:.8},{name:o("lang.insult"),type:"insult",active:!0,threshold:.8},{name:o("lang.violence"),type:"violence",active:!0,threshold:.8}]}}});function x(){function a(e){(e.style_filter_list||[]).forEach(u=>{switch(s[u]=!0,u){case"local_words":t.local_words.form.interval_tokens=10;break;case"baidu_api":t.baidu_api.form.interval_tokens=e.baidu_api.interval_tokens,t.baidu_api.form.api_key=e.baidu_api.api_key,t.baidu_api.form.secret_key=e.baidu_api.secret_key;break;case"local_model":t.local_model.form.model_id=3,t.local_model.form.interval_tokens=10,t.local_model.form.filter_model_list.forEach(v=>{const m=e.local_model.filter_model_list.find(g=>g.type===v.type);v.active=!!m,v.threshold=m?m.threshold:.8})}})}return n.isSettingDefault?new Promise(e=>{a(n.initParams),e(n.initParams)}):W({session_id:k.currentConversationId,plugin_id:n.pluginId}).then(e=>{const{resData:u}=e;a(u)})}const y=L([]);function A(){return J().then(async a=>{var e;await x(),y.value=a.resData,y.value.length&&(t.local_model.form.model_id=((e=y.value[0])==null?void 0:e.id)||"")})}A(),V(()=>t.local_model.form.filter_model_list.filter(a=>a.active).length<=1);const B=w(()=>{const a={session_id:k.currentConversationId,plugin_id:n.pluginId,style_filter_list:Object.keys(t).filter(e=>s[e]),local_words:t.local_words.form,baidu_api:t.baidu_api.form,local_model:Object.assign({},t.local_model.form,{filter_model_list:t.local_model.form.filter_model_list.filter(e=>e.active).map(e=>({type:e.type,threshold:e.threshold}))})};console.log(a),X(a).then(()=>{x(),$.add({severity:"success",summary:o("lang.saveSuccess"),life:3e3})})}),D=w(()=>{const a={session_id:k.currentConversationId,plugin_id:n.pluginId,style_filter_list:Object.keys(t).filter(e=>s[e]),local_words:t.local_words.form,baidu_api:t.baidu_api.form,local_model:Object.assign({},t.local_model.form,{filter_model_list:t.local_model.form.filter_model_list.filter(e=>e.active).map(e=>({type:e.type,threshold:e.threshold}))})};return console.log(a),a});T({exposeSubmit:D});const N=()=>{window.open("https://ai.baidu.com/censoring","_blank")};return(a,e)=>{const u=z,v=Y,m=R,g=F;return h(),C("div",Z,[l("div",ee,[l("div",te,[l("label",le,p(a.$t("lang.baiduApi")),1)]),i(s).baidu_api?(h(),C("div",ae,[l("div",ie,[l("label",oe,p(a.$t("lang.intervalTokens")),1),l("div",se,[l("div",ne,[b(u,{modelValue:i(t).baidu_api.form.interval_tokens,"onUpdate:modelValue":e[0]||(e[0]=r=>i(t).baidu_api.form.interval_tokens=r),class:"w-full grow shrink ml-2",step:1,min:1,max:100},null,8,["modelValue"]),b(v,{id:"baiduApiIntervalTokens",class:"w-20 grow-0 shrink-0",inputStyle:{width:"100%",textAlign:"center"},modelValue:i(t).baidu_api.form.interval_tokens,"onUpdate:modelValue":e[1]||(e[1]=r=>i(t).baidu_api.form.interval_tokens=r),useGrouping:!1,step:1,min:1,max:100},null,8,["modelValue"])]),l("small",re,p(i(f).baidu_api_interval_tokens),1)])]),l("div",de,[l("label",_e,[e[4]||(e[4]=E("API KEY ")),l("a",{target:"_blank",class:"py-0.5 text-sm font-medium text-violet-500 underline decoration-zinc-500/20 underline-offset-4 hover:opacity-90",href:"#",onClick:U(N,["stop","prevent"])}," 点击获取 ")]),l("div",ce,[b(m,{invalid:!!i(f).baidu_api_api_key,class:"w-full",modelValue:i(t).baidu_api.form.api_key,"onUpdate:modelValue":e[2]||(e[2]=r=>i(t).baidu_api.form.api_key=r)},null,8,["invalid","modelValue"]),l("small",ue,p(i(f).baidu_api_api_key),1)])]),l("div",me,[e[5]||(e[5]=l("label",{for:"baiduApiIntervalTokens",class:"font-semibold text-slate-500 dark:text-slate-400"},"SECRET KEY ",-1)),l("div",pe,[b(m,{invalid:!!i(f).baidu_api_secret_key,class:"w-full",modelValue:i(t).baidu_api.form.secret_key,"onUpdate:modelValue":e[3]||(e[3]=r=>i(t).baidu_api.form.secret_key=r)},null,8,["invalid","modelValue"]),l("small",fe,p(i(f).baidu_api_secret_key),1)])])])):I("",!0)]),n.isSettingDefault?I("",!0):(h(),O(g,{key:0,class:"self-end buttons-item",onClick:i(B)},{default:M(()=>[E(p(a.$t("lang.save")),1)]),_:1},8,["onClick"]))])}}},Se=K(ve,[["__scopeId","data-v-10ad3f3e"]]);export{Se as default};
