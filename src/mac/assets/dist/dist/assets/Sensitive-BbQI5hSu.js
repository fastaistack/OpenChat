import{S as E,ah as D,P as S,f as V,e as s,r as N,c as I,o as h,a,m as P,l as C,t as p,b as i,d as b,j as O,x as L,s as U}from"./index-DsTE_LlG.js";import{_ as F,s as K}from"./_plugin-vue_export-helper-CEOctT9D.js";import{a as M}from"./inputnumber.esm-DHnLirwo.js";import{a as R}from"./slider.esm-C-BW2_TT.js";import{c as Y,a as d,u as G}from"./vee-validate-B4phEhVM.js";import{g as z}from"./Markdown-Bs5AWL_3.js";import{u as H}from"./dayjs.min-CfbEY-UA.js";function J(_){return E({method:"get",url:"/plugin-param/sensitive/list",params:_})}function Q(_){return E({method:"put",url:`/plugin-param/sensitive/update/${_.session_id}`,data:_})}const W={class:"sensitive flex flex-col w-full items-center space-y-4"},X={class:"w-full"},Z={class:"flex items-center mb-2"},ee={for:"baidu_api",class:"ml-2 font-semibold labels-item"},te={key:0,class:"pl-6 pr-2 py-2 space-y-2 tabs-item"},le={class:"space-y-1"},ae={for:"baiduApiIntervalTokens",class:"font-semibold text-slate-500 dark:text-slate-400"},ie={class:"w-full flex flex-col items-start justify-start"},se={class:"w-full flex flex-row items-center justify-start gap-4"},oe={class:"text-red-600"},ne={class:"space-y-1"},re={class:"w-full flex flex-col items-start justify-start"},de={class:"text-red-600"},_e={class:"space-y-1"},ce={class:"w-full flex flex-col items-start justify-start"},ue={class:"text-red-600"},me={__name:"Sensitive",props:{pluginId:{type:[String,Number],default:0},initParams:{type:Object,default:()=>null},isSettingDefault:{type:Boolean,default:!1}},setup(_,{expose:j}){const T=D(),k=H(),n=_,o=S({local_words:!1,baidu_api:!0,local_model:!1}),$=V(()=>Y({baidu_api_interval_tokens:o.baidu_api?d().required(s("lang.noEmpty")):d(),baidu_api_api_key:o.baidu_api?d().required(s("lang.noEmpty")):null,baidu_api_secret_key:o.baidu_api?d().required(s("lang.noEmpty")):null,local_model_model_id:o.local_model?d().required(s("lang.noEmpty")):null,local_model_interval_tokens:o.local_model?d().required(s("lang.noEmpty")):d()})),{defineField:c,handleSubmit:x,errors:f}=G({validationSchema:$,initialValues:{local_word_interval_tokens:10,baidu_api_interval_tokens:20,baidu_api_api_key:"",baidu_api_secret_key:"",local_model_model_id:null,local_model_interval_tokens:20,local_model_filter_model_list:[]}}),t=S({local_words:{open:!1,form:{interval_tokens:c("local_word_interval_tokens")[0]}},baidu_api:{open:!0,form:{interval_tokens:c("baidu_api_interval_tokens")[0],api_key:c("baidu_api_api_key")[0],secret_key:c("baidu_api_secret_key")[0]}},local_model:{open:!1,form:{model_id:c("local_model_model_id")[0],interval_tokens:c("local_model_interval_tokens")[0],filter_model_list:[{name:s("lang.politic"),type:"politic",active:!0,threshold:.8},{name:s("lang.porn"),type:"porn",active:!0,threshold:.8},{name:s("lang.insult"),type:"insult",active:!0,threshold:.8},{name:s("lang.violence"),type:"violence",active:!0,threshold:.8}]}}});function w(){function l(e){(e.style_filter_list||[]).forEach(u=>{switch(o[u]=!0,u){case"local_words":t.local_words.form.interval_tokens=10;break;case"baidu_api":t.baidu_api.form.interval_tokens=e.baidu_api.interval_tokens,t.baidu_api.form.api_key=e.baidu_api.api_key,t.baidu_api.form.secret_key=e.baidu_api.secret_key;break;case"local_model":t.local_model.form.model_id=3,t.local_model.form.interval_tokens=10,t.local_model.form.filter_model_list.forEach(v=>{const m=e.local_model.filter_model_list.find(g=>g.type===v.type);v.active=!!m,v.threshold=m?m.threshold:.8})}})}return n.isSettingDefault?new Promise(e=>{l(n.initParams),e(n.initParams)}):J({session_id:k.currentConversationId,plugin_id:n.pluginId}).then(e=>{const{resData:u}=e;l(u)})}const y=N([]);function A(){return z().then(async l=>{var e;await w(),y.value=l.resData,y.value.length&&(t.local_model.form.model_id=((e=y.value[0])==null?void 0:e.id)||"")})}A(),V(()=>t.local_model.form.filter_model_list.filter(l=>l.active).length<=1);const q=x(()=>{const l={session_id:k.currentConversationId,plugin_id:n.pluginId,style_filter_list:Object.keys(t).filter(e=>o[e]),local_words:t.local_words.form,baidu_api:t.baidu_api.form,local_model:Object.assign({},t.local_model.form,{filter_model_list:t.local_model.form.filter_model_list.filter(e=>e.active).map(e=>({type:e.type,threshold:e.threshold}))})};console.log(l),Q(l).then(()=>{w(),T.add({severity:"success",summary:s("lang.saveSuccess"),life:3e3})})}),B=x(()=>{const l={session_id:k.currentConversationId,plugin_id:n.pluginId,style_filter_list:Object.keys(t).filter(e=>o[e]),local_words:t.local_words.form,baidu_api:t.baidu_api.form,local_model:Object.assign({},t.local_model.form,{filter_model_list:t.local_model.form.filter_model_list.filter(e=>e.active).map(e=>({type:e.type,threshold:e.threshold}))})};return console.log(l),l});return j({exposeSubmit:B}),(l,e)=>{const u=R,v=M,m=K,g=U;return h(),I("div",W,[a("div",X,[a("div",Z,[a("label",ee,p(l.$t("lang.baiduApi")),1)]),i(o).baidu_api?(h(),I("div",te,[a("div",le,[a("label",ae,p(l.$t("lang.intervalTokens")),1),a("div",ie,[a("div",se,[b(u,{modelValue:i(t).baidu_api.form.interval_tokens,"onUpdate:modelValue":e[0]||(e[0]=r=>i(t).baidu_api.form.interval_tokens=r),class:"w-full grow shrink ml-2",step:1,min:1,max:100},null,8,["modelValue"]),b(v,{id:"baiduApiIntervalTokens",class:"w-20 grow-0 shrink-0",inputStyle:{width:"100%",textAlign:"center"},modelValue:i(t).baidu_api.form.interval_tokens,"onUpdate:modelValue":e[1]||(e[1]=r=>i(t).baidu_api.form.interval_tokens=r),useGrouping:!1,step:1,min:1,max:100},null,8,["modelValue"])]),a("small",oe,p(i(f).baidu_api_interval_tokens),1)])]),a("div",ne,[e[4]||(e[4]=a("label",{for:"baiduApiIntervalTokens",class:"font-semibold text-slate-500 dark:text-slate-400"},"API KEY",-1)),a("div",re,[b(m,{invalid:!!i(f).baidu_api_api_key,class:"w-full",modelValue:i(t).baidu_api.form.api_key,"onUpdate:modelValue":e[2]||(e[2]=r=>i(t).baidu_api.form.api_key=r)},null,8,["invalid","modelValue"]),a("small",de,p(i(f).baidu_api_api_key),1)])]),a("div",_e,[e[5]||(e[5]=a("label",{for:"baiduApiIntervalTokens",class:"font-semibold text-slate-500 dark:text-slate-400"},"SECRET KEY",-1)),a("div",ce,[b(m,{invalid:!!i(f).baidu_api_secret_key,class:"w-full",modelValue:i(t).baidu_api.form.secret_key,"onUpdate:modelValue":e[3]||(e[3]=r=>i(t).baidu_api.form.secret_key=r)},null,8,["invalid","modelValue"]),a("small",ue,p(i(f).baidu_api_secret_key),1)])])])):C("",!0)]),n.isSettingDefault?C("",!0):(h(),P(g,{key:0,class:"self-end buttons-item",onClick:i(q)},{default:O(()=>[L(p(l.$t("lang.save")),1)]),_:1},8,["onClick"]))])}}},he=F(me,[["__scopeId","data-v-6910d5c2"]]);export{he as default};
