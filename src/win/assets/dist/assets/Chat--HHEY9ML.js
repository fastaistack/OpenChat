const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Sensitive-CrMfk-Jt.js","assets/index-B9s1B9jQ.js","assets/index-Yv0WcvhJ.css","assets/_plugin-vue_export-helper-D8ncxyMm.js","assets/inputnumber.esm-CIhko8if.js","assets/slider.esm-BAPKB8wQ.js","assets/vee-validate-Ce0Yf3uk.js","assets/Markdown-CsFcuW9P.js","assets/Markdown-CgTvER6F.css","assets/dayjs.min-BF7iIa5r.js","assets/Sensitive-EvbIBg1m.css","assets/WebSearch-D60MhxJn.js","assets/dropdown.esm-C8QGVjDp.js","assets/knowledge-RiB-jk2J.js","assets/WebSearch-DRNdLoBq.css","assets/knowledges-DQOrPNcp.js","assets/DocChatConfig-C3P-oQsp.js","assets/card.esm-B2Yyg_5c.js","assets/avatar.esm-3QHyxOKf.js","assets/FileViewer-DbFKQZGF.js","assets/knowledges-DBVrF2Kp.css","assets/DocChat-CPJOfEC_.js","assets/fileupload.esm-CQF3QjHR.js","assets/FileIcon-CdRjaYE1.js","assets/index.esm-BP7LFGzw.js","assets/CodeAnalysis-zmBK5T45.js"])))=>i.map(i=>d[i]);
import{s as St,a as It,b as Lt}from"./slider.esm-BAPKB8wQ.js";import{s as Ot}from"./dropdown.esm-C8QGVjDp.js";import{s as Tt,a as Pt}from"./inputnumber.esm-CIhko8if.js";import{C as He,D as We,c as h,o as p,a as r,d as I,E as fe,l as T,G as U,t as P,n as q,H as Ce,m as N,I as Et,J as Nt,q as Xe,j as R,L as Vt,T as Rt,R as Mt,M as Ye,U as ot,N as jt,O as ut,r as C,F as z,B as Ut,f as V,P as Dt,Q as ge,b as g,k as se,u as pt,x as Q,s as Ie,p as ee,S as $e,z as ft,i as Be,V as qt,e as zt,W as we,_ as xe,A as Bt,X as Ft,Y as Ht,Z as Me}from"./index-B9s1B9jQ.js";import{u as Ue,M as st}from"./Markdown-CsFcuW9P.js";import{u as me,d as Wt,g as Xt,e as Yt,a as $t,b as Jt,m as Zt,c as Gt}from"./dayjs.min-BF7iIa5r.js";import{s as Kt,_ as Le,c as Qt,g as en,a as ke}from"./_plugin-vue_export-helper-D8ncxyMm.js";import{s as tn}from"./card.esm-B2Yyg_5c.js";import{s as nn}from"./avatar.esm-3QHyxOKf.js";import{_ as on}from"./FileViewer-DbFKQZGF.js";var sn={root:function(t){var n=t.props;return["p-panel p-component",{"p-panel-toggleable":n.toggleable}]},header:"p-panel-header",title:"p-panel-title",icons:"p-panel-icons",toggler:"p-panel-header-icon p-panel-toggler p-link",toggleablecontent:"p-toggleable-content",content:"p-panel-content",footer:"p-panel-footer"},an=He.extend({name:"panel",classes:sn}),ln={name:"BasePanel",extends:Ye,props:{header:String,toggleable:Boolean,collapsed:Boolean,toggleButtonProps:{type:null,default:null}},style:an,provide:function(){return{$parentInstance:this}}},gt={name:"Panel",extends:ln,inheritAttrs:!1,emits:["update:collapsed","toggle"],data:function(){return{id:this.$attrs.id,d_collapsed:this.collapsed}},watch:{"$attrs.id":function(t){this.id=t||ot()},collapsed:function(t){this.d_collapsed=t}},mounted:function(){this.id=this.id||ot()},methods:{toggle:function(t){this.d_collapsed=!this.d_collapsed,this.$emit("update:collapsed",this.d_collapsed),this.$emit("toggle",{originalEvent:t,value:this.d_collapsed})},onKeyDown:function(t){(t.code==="Enter"||t.code==="NumpadEnter"||t.code==="Space")&&(this.toggle(t),t.preventDefault())}},computed:{buttonAriaLabel:function(){return this.toggleButtonProps&&this.toggleButtonProps.ariaLabel?this.toggleButtonProps.ariaLabel:this.header}},components:{PlusIcon:Tt,MinusIcon:St},directives:{ripple:Mt}};function Se(e){"@babel/helpers - typeof";return Se=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Se(e)}function it(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,o)}return n}function at(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?it(Object(n),!0).forEach(function(o){rn(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):it(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function rn(e,t,n){return t=cn(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function cn(e){var t=dn(e,"string");return Se(t)=="symbol"?t:String(t)}function dn(e,t){if(Se(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(Se(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var un=["id"],pn=["id","aria-label","aria-controls","aria-expanded"],fn=["id","aria-labelledby"];function gn(e,t,n,o,i,d){var m=We("ripple");return p(),h("div",U({class:e.cx("root")},e.ptmi("root")),[r("div",U({class:e.cx("header")},e.ptm("header")),[fe(e.$slots,"header",{id:i.id+"_header",class:q(e.cx("title"))},function(){return[e.header?(p(),h("span",U({key:0,id:i.id+"_header",class:e.cx("title")},e.ptm("title")),P(e.header),17,un)):T("",!0)]}),r("div",U({class:e.cx("icons")},e.ptm("icons")),[fe(e.$slots,"icons"),e.toggleable?Ce((p(),h("button",U({key:0,id:i.id+"_header",type:"button",role:"button",class:e.cx("toggler"),"aria-label":d.buttonAriaLabel,"aria-controls":i.id+"_content","aria-expanded":!i.d_collapsed,onClick:t[0]||(t[0]=function(){return d.toggle&&d.toggle.apply(d,arguments)}),onKeydown:t[1]||(t[1]=function(){return d.onKeyDown&&d.onKeyDown.apply(d,arguments)})},at(at({},e.toggleButtonProps),e.ptm("toggler"))),[fe(e.$slots,"togglericon",{collapsed:i.d_collapsed},function(){return[(p(),N(Xe(i.d_collapsed?"PlusIcon":"MinusIcon"),Et(Nt(e.ptm("togglericon"))),null,16))]})],16,pn)),[[m]]):T("",!0)],16)],16),I(Rt,U({name:"p-toggleable-content"},e.ptm("transition")),{default:R(function(){return[Ce(r("div",U({id:i.id+"_content",class:e.cx("toggleablecontent"),role:"region","aria-labelledby":i.id+"_header"},e.ptm("toggleablecontent")),[r("div",U({class:e.cx("content")},e.ptm("content")),[fe(e.$slots,"default")],16),e.$slots.footer?(p(),h("div",U({key:0,class:e.cx("footer")},e.ptm("footer")),[fe(e.$slots,"footer")],16)):T("",!0)],16,fn),[[Vt,!i.d_collapsed]])]}),_:3},16)],16)}gt.render=gn;async function mn(e,t){const n=e.getReader();let o;for(;!(o=await n.read()).done;)t(o.value)}function vn(e){let t,n,o,i=!1;return function(m){t===void 0?(t=m,n=0,o=-1):t=yn(t,m);const v=t.length;let s=0;for(;n<v;){i&&(t[n]===10&&(s=++n),i=!1);let l=-1;for(;n<v&&l===-1;++n)switch(t[n]){case 58:o===-1&&(o=n-s);break;case 13:i=!0;case 10:l=n;break}if(l===-1)break;e(t.subarray(s,l),o),s=n,o=-1}s===v?t=void 0:s!==0&&(t=t.subarray(s),n-=s)}}function hn(e,t,n){let o=lt();const i=new TextDecoder;return function(m,v){if(m.length===0)n==null||n(o),o=lt();else if(v>0){const s=i.decode(m.subarray(0,v)),l=v+(m[v+1]===32?2:1),c=i.decode(m.subarray(l));switch(s){case"data":o.data=o.data?o.data+`
`+c:c;break;case"event":o.event=c;break;case"id":e(o.id=c);break;case"retry":const u=parseInt(c,10);isNaN(u)||t(o.retry=u);break}}}}function yn(e,t){const n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function lt(){return{data:"",event:"",id:"",retry:void 0}}var bn=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]]);return n};const Fe="text/event-stream",An=1e3,rt="last-event-id";function _n(e,t){var{signal:n,headers:o,onopen:i,onmessage:d,onclose:m,onerror:v,openWhenHidden:s,fetch:l}=t,c=bn(t,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((u,b)=>{const w=Object.assign({},o);w.accept||(w.accept=Fe);let E;function D(){E.abort(),document.hidden||te()}s||document.addEventListener("visibilitychange",D);let F=An,Y=0;function k(){document.removeEventListener("visibilitychange",D),window.clearTimeout(Y),E.abort()}n==null||n.addEventListener("abort",()=>{k(),u()});const L=l??window.fetch,ie=i??wn;async function te(){var W;E=new AbortController;try{const H=await L(e,Object.assign(Object.assign({},c),{headers:w,signal:E.signal}));await ie(H),await mn(H.body,vn(hn(O=>{O?w[rt]=O:delete w[rt]},O=>{F=O},d))),m==null||m(),k(),u()}catch(H){if(!E.signal.aborted)try{const O=(W=v==null?void 0:v(H))!==null&&W!==void 0?W:F;window.clearTimeout(Y),Y=window.setTimeout(te,O)}catch(O){k(),b(O)}}}te()})}function wn(e){const t=e.headers.get("content-type");if(!(t!=null&&t.startsWith(Fe)))throw new Error(`Expected content-type to be ${Fe}, Actual: ${t}`)}const xn=jt(),kn="",ct=(e,{onmessage:t,onopen:n,openWhenHidden:o=!0,params:i={},onerror:d=v=>{throw console.error(v),v},signal:m})=>{const v=xn.token;return _n(`${kn}${e}`,{method:"post",onmessage:t,onopen:n,onerror:d,openWhenHidden:o,body:JSON.stringify(i),headers:{"Content-Type":"application/json",Authorization:`Bearer ${v}`},signal:m})},Cn=ut("knowledge",()=>{const e=C({});function t(l){e.value=Object.assign({},l)}const n=C(!1),o=C({});function i(l){n.value=l}function d(l){o.value=Object.assign({},l)}function m(){return{knowledge_id:e.value.id,knowledge_name:e.value.name}}function v(){return o.value.id?[{knowledge_id:me().currentConversationId,file_id:o.value.id,file_name:o.value.name}]:[]}function s(){e.value={},o.value={}}return{selectedKb:e,setKbdata:t,viewFileFlag:n,fileInfo:o,setFileView:i,setFileInfo:d,getKbData:m,getChatFileData:v,clearPluginData:s}}),Sn={__name:"Number",props:{modelValue:{type:Number,default:0},config:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(e,{emit:t}){const n=t;function o(d){n("update:modelValue",d)}function i(d=0){return 1/Math.pow(10,d)}return(d,m)=>{const v=It,s=Pt;return p(),h(z,null,[I(v,{modelValue:e.modelValue,"onUpdate:modelValue":o,class:"w-full grow shrink",step:i(e.config.arg_precision),min:e.config.arg_min||0,max:e.config.arg_max||8e3},null,8,["modelValue","step","min","max"]),I(s,{class:"w-20 grow-0 shrink-0 border-clear-deep",inputStyle:{width:"100%",textAlign:"center"},modelValue:e.modelValue,"onUpdate:modelValue":o,useGrouping:!1,step:i(e.config.arg_precision),min:e.config.arg_min||0,max:e.config.arg_max||8e3},null,8,["modelValue","step","min","max"])],64)}}};var In={root:{position:"relative"}},Ln={root:function(t){var n=t.instance,o=t.props;return["p-inputswitch p-component",{"p-highlight":n.checked,"p-disabled":o.disabled,"p-invalid":o.invalid}]},input:"p-inputswitch-input",slider:"p-inputswitch-slider"},On=He.extend({name:"inputswitch",classes:Ln,inlineStyles:In}),Tn={name:"BaseInputSwitch",extends:Ye,props:{modelValue:{type:null,default:!1},trueValue:{type:null,default:!0},falseValue:{type:null,default:!1},invalid:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},tabindex:{type:Number,default:null},inputId:{type:String,default:null},inputClass:{type:[String,Object],default:null},inputStyle:{type:Object,default:null},ariaLabelledby:{type:String,default:null},ariaLabel:{type:String,default:null}},style:On,provide:function(){return{$parentInstance:this}}},mt={name:"InputSwitch",extends:Tn,inheritAttrs:!1,emits:["update:modelValue","change","focus","blur"],methods:{getPTOptions:function(t){var n=t==="root"?this.ptmi:this.ptm;return n(t,{context:{checked:this.checked,disabled:this.disabled}})},onChange:function(t){if(!this.disabled&&!this.readonly){var n=this.checked?this.falseValue:this.trueValue;this.$emit("update:modelValue",n),this.$emit("change",t)}},onFocus:function(t){this.$emit("focus",t)},onBlur:function(t){this.$emit("blur",t)}},computed:{checked:function(){return this.modelValue===this.trueValue}}},Pn=["data-p-highlight","data-p-disabled"],En=["id","checked","tabindex","disabled","readonly","aria-checked","aria-labelledby","aria-label","aria-invalid"];function Nn(e,t,n,o,i,d){return p(),h("div",U({class:e.cx("root"),style:e.sx("root")},d.getPTOptions("root"),{"data-p-highlight":d.checked,"data-p-disabled":e.disabled}),[r("input",U({id:e.inputId,type:"checkbox",role:"switch",class:[e.cx("input"),e.inputClass],style:e.inputStyle,checked:d.checked,tabindex:e.tabindex,disabled:e.disabled,readonly:e.readonly,"aria-checked":d.checked,"aria-labelledby":e.ariaLabelledby,"aria-label":e.ariaLabel,"aria-invalid":e.invalid||void 0,onFocus:t[0]||(t[0]=function(){return d.onFocus&&d.onFocus.apply(d,arguments)}),onBlur:t[1]||(t[1]=function(){return d.onBlur&&d.onBlur.apply(d,arguments)}),onChange:t[2]||(t[2]=function(){return d.onChange&&d.onChange.apply(d,arguments)})},d.getPTOptions("input")),null,16,En),r("span",U({class:e.cx("slider")},d.getPTOptions("slider")),null,16)],16,Pn)}mt.render=Nn;const Vn={__name:"Boolean",props:{modelValue:{type:String,default:"False"},config:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(e,{emit:t}){const n=t;function o(i){n("update:modelValue",i)}return(i,d)=>{const m=mt;return p(),N(m,{modelValue:e.modelValue,trueValue:"True",falseValue:"False","onUpdate:modelValue":o},null,8,["modelValue"])}}},Rn={__name:"Textarea",props:{modelValue:{type:String,default:""},config:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(e,{emit:t}){const n=t;function o(i){n("update:modelValue",i)}return(i,d)=>{const m=Ut("Textarea",!0);return p(),N(m,{autoresize:!1,modelValue:e.modelValue,"onUpdate:modelValue":o,maxlength:e.config.arg_maxlen||500},null,8,["modelValue","maxlength"])}}},Mn={__name:"Text",props:{modelValue:{type:String,default:""},config:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(e,{emit:t}){const n=t;function o(i){n("update:modelValue",i)}return(i,d)=>{const m=Kt;return p(),N(m,{modelValue:e.modelValue,"onUpdate:modelValue":o},null,8,["modelValue"])}}},jn={class:"model-params space-y-4"},Un={key:0,class:"flex flex-col items-center justify-center pt-32"},Dn={class:"text-slate-500 text-xl"},qn={for:"maxLength",class:"text-slate-500 font-bold text-sm"},zn={class:"flex flex-row items-center justify-start mt-1 space-x-4"},Bn={__name:"ModelParams",setup(e){const t=Ue(),n=me(),o=V(()=>t.loadedModel),i=V(()=>{var l;return((l=o.value)==null?void 0:l.id)||""}),d=C([]),m=Dt({});async function v(){var l;return d.value=await t.getModelParamsConfig(i.value,n.currentConversationId),(l=d.value)==null||l.forEach(c=>{if(c.arg_name)switch(c.arg_datatype){case"number":m[c.arg_name]=+c.arg_value;break;case"bool":default:m[c.arg_name]="False";break}}),ge(()=>m,async c=>{await t.setModelParams(i.value,c,n.currentConversationId)},{deep:!0}),m}ge(()=>i.value,async l=>{l&&n.currentConversationId&&await v()},{immediate:!0});const s={number:Sn,bool:Vn,textarea:Rn,string:Mn};return(l,c)=>(p(),h("div",jn,[g(i)?(p(!0),h(z,{key:1},se(g(d),u=>(p(),h("div",{class:"form_item",key:u.arg_name},[r("label",qn,P(u.arg_name),1),r("div",zn,[(p(),N(Xe(s[u.arg_datatype]),{modelValue:g(m)[u.arg_name],"onUpdate:modelValue":b=>g(m)[u.arg_name]=b,config:u},null,8,["modelValue","onUpdate:modelValue","config"]))])]))),128)):(p(),h("div",Un,[c[0]||(c[0]=r("i",{class:"pi pi-box text-3xl text-slate-500 mb-4"},null,-1)),r("div",Dn,P(l.$t("lang.noModel")),1)]))]))}},Fn={class:"setting_container shadow-md rounded-3xl h-full shrink grow bg-transparent dark:bg-slate-800 p-4 flex flex-col items-start justify-start"},Hn={class:"settings w-full h-full grow shrink space-y-4 mt-6 overflow-y-auto px-3 pb-2"},Wn={__name:"Setting",setup(e){const t=me();return(n,o)=>(p(),h("div",Fn,[r("div",Hn,[(p(),N(Bn,{key:g(t).currentConversationId}))])]))}};var Xn={root:function(t){var n=t.props;return{justifyContent:n.layout==="horizontal"?n.align==="center"||n.align===null?"center":n.align==="left"?"flex-start":n.align==="right"?"flex-end":null:null,alignItems:n.layout==="vertical"?n.align==="center"||n.align===null?"center":n.align==="top"?"flex-start":n.align==="bottom"?"flex-end":null:null}}},Yn={root:function(t){var n=t.props;return["p-divider p-component","p-divider-"+n.layout,"p-divider-"+n.type,{"p-divider-left":n.layout==="horizontal"&&(!n.align||n.align==="left")},{"p-divider-center":n.layout==="horizontal"&&n.align==="center"},{"p-divider-right":n.layout==="horizontal"&&n.align==="right"},{"p-divider-top":n.layout==="vertical"&&n.align==="top"},{"p-divider-center":n.layout==="vertical"&&(!n.align||n.align==="center")},{"p-divider-bottom":n.layout==="vertical"&&n.align==="bottom"}]},content:"p-divider-content"},$n=He.extend({name:"divider",classes:Yn,inlineStyles:Xn}),Jn={name:"BaseDivider",extends:Ye,props:{align:{type:String,default:null},layout:{type:String,default:"horizontal"},type:{type:String,default:"solid"}},style:$n,provide:function(){return{$parentInstance:this}}},Je={name:"Divider",extends:Jn,inheritAttrs:!1},Zn=["aria-orientation"];function Gn(e,t,n,o,i,d){return p(),h("div",U({class:e.cx("root"),style:e.sx("root"),role:"separator","aria-orientation":e.layout},e.ptmi("root")),[e.$slots.default?(p(),h("div",U({key:0,class:e.cx("content")},e.ptm("content")),[fe(e.$slots,"default")],16)):T("",!0)],16,Zn)}Je.render=Gn;const Kn=["href"],Qn={__name:"SvgIcon",props:{iconId:{type:String,required:!0},svgClass:{type:String,default:""}},setup(e){const t=e,n=V(()=>`/yuan-chat/icons/SvgSprite.svg#${t.iconId}`);return(o,i)=>(p(),h("svg",U({class:e.svgClass},o.$attrs),[r("use",{href:g(n)},null,8,Kn)],16))}},eo=Le(Qn,[["__scopeId","data-v-72df09cb"]]),to={__name:"Icon",props:{icon:{type:String,default:""}},setup(e){const t=e,n=V(()=>{var o;return(o=t.icon)==null?void 0:o.startsWith("pi pi-")});return(o,i)=>g(n)?(p(),h("span",{key:0,class:q(["prime-icon",[e.icon]])},null,2)):(p(),N(eo,{key:1,"icon-id":e.icon},null,8,["icon-id"]))}},vt=Le(to,[["__scopeId","data-v-14b83858"]]),no={},oo={class:"loading"};function so(e,t){return p(),h("div",oo,t[0]||(t[0]=[r("div",null,null,-1),r("div",null,null,-1),r("div",null,null,-1)]))}const io=Le(no,[["render",so],["__scopeId","data-v-409d5d31"]]),ao={key:0,class:"absolute top-1 flex flex-row items-center justify-start text-slate-500 gap-1"},lo={class:"text-slate-700"},ro={class:"content leading-6 tracking-wider"},co={key:0,class:"border-clear border-l-2 border-solid border-zinc-300 mb-4 pl-3 text-md"},uo={style:{"font-size":"1rem"}},po={key:0,class:"pi pi-spin pi-spinner",style:{"font-size":"1rem"}},fo={class:"min-h-0"},go={key:1,class:"break-words overflow-x-auto"},mo={key:0,class:"resource"},vo={class:"text-xs text-slate-400"},ho={class:"source_list grid grid-cols-3 gap-4"},yo=["href"],bo={class:"text-slate-600 dark:text-slate-300 truncate max-w-full underline"},Ao={class:"text-wrap text-sm text-slate-500 dark:text-slate-200 leading-6 line-clamp-4"},_o={class:"text-xs text-slate-400"},wo={class:"source_list flex flex-row flex-wrap gap-4 items-center justify-start"},xo=["onClick"],ko={class:"text-wrap text-sm text-slate-500 dark:text-slate-200 truncate"},Co={key:2,class:"absolute -bottom-8 right-4 text-slate-900 space-x-4"},So={class:"absolute -bottom-8 left-4 text-slate-900 space-x-4"},Io="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",Lo={__name:"ChatItem",props:{sender:{default:"",type:String},content:{default:()=>[],type:Array},isLoading:{type:Boolean,default:!1},typing:{type:Boolean,default:!1},questionId:{type:[Number,String],default:""}},emits:["sendFeedback","useRecommend","deleteChatItem","regenerate"],setup(e,{emit:t}){const n=pt(),o=Ue(),i=e,d=t;function m(k,L){d("sendFeedback",L,i.questionId,k)}function v(k){d("useRecommend",k)}function s(){d("regenerate",i.questionId)}function l(k){console.log("deleteChatItem",i.questionId),n.require({target:k.currentTarget,message:"确定删除该条目吗?",icon:"pi pi-info-circle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-danger p-button-sm",rejectLabel:"取消",acceptLabel:"删除",accept:()=>{d("deleteChatItem",i.questionId)}})}const c=C(Math.max(i.content.length-1,0)),u=V(()=>i.content[c.value]||{});function b(){console.log(c.value,Math.max(0,c.value-1)),c.value=Math.max(0,c.value-1)}function w(){const k=i.content.length;c.value=Math.min(k-1,c.value+1)}ge(()=>i.content.length,k=>{c.value=k-1});const E=C(!0);function D(){E.value=!E.value}const F=C(!1);function Y(k,L=!1){k.content&&(Qt(k.content),L&&d("copyMessage",k.content),F.value=!0,setTimeout(()=>{F.value=!1},2e3))}return(k,L)=>{var O,K,$,ae,re,ce,Oe,Te,ve,le,de,Pe,he,M,Ee,ue,Ne,ye,pe;const ie=nn,te=vt,W=Je,H=tn;return p(),h("div",{class:q(["group/chat pb-8 relative w-full flex items-start gap-4 justify-start",e.sender!=="user"?["flex-row"]:["flex-row-reverse"]])},[r("div",{class:q(["avatar mt-8",e.sender!=="user"?["self-start"]:["self-end"]])},[e.sender==="system"?(p(),N(ie,{key:0,class:"overflow-hidden",size:"large",image:((O=g(u))==null?void 0:O.model_pic)||((K=g(o).loadedModel)==null?void 0:K.model_pic)||Io},null,8,["image"])):(p(),N(ie,{key:1,size:"large",icon:"pi pi-user"}))],2),e.content.length>1?(p(),h("div",ao,[r("i",{class:"cursor-pointer pi pi-angle-left",onClick:b}),r("span",lo,P(g(c)+1),1),r("i",{class:"cursor-pointer pi pi-angle-right",onClick:w})])):T("",!0),r("div",{class:q(["chat_item min-w-[40%] p-4 rounded-2xl max-w-[75%] relative pb-8 mt-8",e.sender!=="user"?["rounded-tl","bg-white dark:bg-slate-900","text-slate-800 dark:text-slate-200"]:["rounded-br","bg-blue-500 dark:bg-blue-300","text-white dark:text-black"]])},[r("div",ro,[e.isLoading?(p(),N(io,{key:0})):(p(),h(z,{key:1},[e.sender==="system"?(p(),h(z,{key:0},[($=g(u))!=null&&$.think?(p(),h("div",co,[r("div",{class:"mb-2 text-slate-500 dark:text-slate-200 flex items-center justify-start gap-2 cursor-pointer",onClick:D},[r("span",uo,[L[3]||(L[3]=Q(" 深度思考 ")),(ae=g(u))!=null&&ae.content?T("",!0):(p(),h("i",po))]),I(te,{class:"text-xs",icon:g(E)?"pi pi-angle-up":"pi pi-angle-down"},null,8,["icon"])]),r("div",{class:q(["text-slate-400 dark:text-slate-300 grid overflow-hidden transition-all duration-300 ease-in-out",g(E)?"grid-rows-[1fr]":"grid-rows-[0fr]"])},[r("div",fo,[I(st,{content:(re=g(u))==null?void 0:re.think},null,8,["content"])])],2)])):T("",!0),I(st,{content:((ce=g(u))==null?void 0:ce.content)||""},null,8,["content"])],64)):e.sender==="user"?(p(),h("div",go,P((Oe=g(u))==null?void 0:Oe.content),1)):T("",!0)],64))]),e.sender==="system"?(p(),h("div",mo,[!e.typing&&((Te=g(u))!=null&&Te.refs)&&((ve=g(u))!=null&&ve.refs.length)?(p(),h(z,{key:0},[I(W,{align:"left",class:""},{default:R(()=>[r("span",vo,P(k.$t("lang.sources")),1)]),_:1}),r("div",ho,[(p(!0),h(z,null,se(((le=g(u))==null?void 0:le.refs)||[],j=>(p(),h("a",{class:"cursor-pointer",href:j.url,key:j.url,target:"_blank"},[I(H,{class:"bg-blue-200 dark:bg-blue-600 bg-opacity-30 h-full hover:bg-opacity-50"},{title:R(()=>[r("div",bo,P(j.title),1)]),content:R(()=>[r("div",Ao,P(j.text),1)]),_:2},1024)],8,yo))),128))])],64)):T("",!0),!e.typing&&((de=g(u))!=null&&de.recommend_question)&&((Pe=g(u))!=null&&Pe.recommend_question.length)?(p(),h(z,{key:1},[I(W,{align:"left",class:""},{default:R(()=>[r("span",_o,P(k.$t("lang.related")),1)]),_:1}),r("div",wo,[(p(!0),h(z,null,se(((he=g(u))==null?void 0:he.recommend_question)||[],j=>(p(),h("div",{key:j.question,class:"cursor-pointer",onClick:J=>v(j.question)},[I(H,{class:"bg-blue-200 dark:bg-blue-600 bg-opacity-30 h-full hover:bg-opacity-50",pt:{body:{class:"py-2 px-4"}}},{content:R(()=>[r("div",ko,P(j.question),1)]),_:2},1024)],8,xo))),128))])],64)):T("",!0)])):T("",!0),(M=g(u))!=null&&M.time?(p(),h("div",{key:1,class:q(["time absolute right-4 bottom-1 text-sm font-semibold",e.sender==="system"?["text-slate-400"]:["text-slate-200 dark:text-slate-700"]])},P(g(Wt)((Ee=g(u))==null?void 0:Ee.time).format("HH:mm")),3)):T("",!0),e.sender==="system"?(p(),h("div",Co,[r("i",{onClick:L[0]||(L[0]=j=>{var J;return m(1,(J=g(u))==null?void 0:J.id)}),style:{"font-size":"1rem"},class:q(["group-hover/chat:inline pi cursor-pointer",[((ue=g(u))==null?void 0:ue.feedback)===1?"pi pi-thumbs-up-fill text-blue-500":"pi-thumbs-up",((Ne=g(u))==null?void 0:Ne.feedback)!==0?"inline":"hidden"]])},null,2),r("i",{onClick:L[1]||(L[1]=j=>{var J;return m(2,(J=g(u))==null?void 0:J.id)}),style:{"font-size":"1rem"},class:q(["group-hover/chat:inline pi cursor-pointer",[((ye=g(u))==null?void 0:ye.feedback)===2?"pi pi-thumbs-down-fill text-red-500":"pi-thumbs-down",((pe=g(u))==null?void 0:pe.feedback)!==0?"inline":"hidden"]])},null,2)])):T("",!0),r("div",So,[e.sender==="user"?(p(),h("i",{key:0,onClick:s,style:{"font-size":"1rem"},class:"group-hover/chat:inline hidden text-primary-500 pi pi-sync cursor-pointer"})):T("",!0),e.sender==="user"?(p(),h("button",{key:1,onClick:l,class:"group-hover/chat:inline hidden bg-transparent border-none p-0","aria-label":"删除"},L[4]||(L[4]=[r("i",{style:{"font-size":"1rem"},class:"text-orange-600 pi pi-trash cursor-pointer"},null,-1)]))):T("",!0),r("i",{onClick:L[2]||(L[2]=j=>Y(g(u),e.sender==="user")),style:{"font-size":"1rem"},class:q(["group-hover/chat:inline hidden cursor-pointer",g(F)?"pi pi-check":"pi pi-copy"])},null,2)])],2)],2)}}},Oo={class:"welcome w-full h-full dark:bg-slate-800 flex flex-col items-center justify-center mx-auto relative gap-6"},To=["src"],Po={class:"text-center flex items-center justify-center gap-2"},Eo=["src"],No={class:"flex flex-row items-center justify-center gap-2"},Vo="data:image/png;base64,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",Ro={__name:"Welcome",emits:["useRecommend"],setup(e,{emit:t}){const n=Ue(),o=t,i=C([]);function d(){return Xt().then(c=>{i.value=c})}d();function m(c){o("useRecommend",c)}const v=V(()=>"/yuan-chat/"),s=V(()=>n.loadedModel);function l(){ee.emit("showWhatsNew")}return(c,u)=>{var w;const b=Ie;return p(),h("div",Oo,[r("img",{class:"w-28 h-28 rounded-full bg-transparent",src:((w=g(s))==null?void 0:w.model_pic)||Vo,alt:""},null,8,To),u[1]||(u[1]=r("div",{class:""},null,-1)),I(b,{rounded:"",severity:"info",onClick:l},{default:R(()=>[r("div",Po,[r("img",{class:"w-4 h-4",src:`${g(v)}image/app/star.svg`,alt:""},null,8,Eo),u[0]||(u[0]=r("span",null,"点击查看OpenChat功能",-1))])]),_:1}),u[2]||(u[2]=r("div",{class:"text-xl text-zinc-500"},"有什么需要帮助的？",-1)),r("div",No,[(p(!0),h(z,null,se(g(i),E=>(p(),N(b,{key:E,severity:"secondary",outlined:"",rounded:"",label:E,onClick:D=>m(E)},null,8,["label","onClick"]))),128))])])}}},Mo="/yuan-chat/";function jo(e){return $e({method:"post",url:"/plugin/session/getlist",data:e})}function Uo(e){return $e({method:"post",url:"/plugin/get",data:e})}const Do=4;function qo(){return fetch(`${Mo}code-analysis-recommends.json`).then(e=>e.json()).then(e=>en(e,Do))}function zo(e){return $e({method:"post",url:"/plugin/session/update",data:e})}const De=ut("plugins",()=>{const e=me(),t=V(()=>e.currentConversationId),n=C([]);function o(){if(!t.value)return;const v={session_id:t.value,plugin_type:"normal",status:!0,search_type:"one_type_status_nopost"};return jo(v).then(s=>{const{resData:l}=s;n.value=l})}ge(()=>t.value,async v=>{v&&await o()},{immediate:!0});function i(v,s){const l=n.value.map(c=>({session_id:t.value,plugin_id:c.plugin_id,update_val:{session_status:c.plugin_id===v.plugin_id?s:!1}}));return zo(l)}function d(v){return Uo({pluginName:v}).then(s=>s.resData)}function m(v){var s;return((s=n.value.find(l=>l.plugin_key===v))==null?void 0:s.session_status)||!1}return{pluginList:n,getSessionPluginList:o,changePluginStatus:i,getPlugin:d,getLocalPluginStatus:m}}),je={titleCN:"OpenChat开源许可协议",cn:`<h1>OpenChat开源许可协议</h1>

  <p>发布日期:2024年01月03日</p>
  <p>生效日期:2024年01月03日</p>

  <p>点击同意或浏览或使用或分发OpenChat项目的任何部分，您将被视为认可并接受本协议的内容，本协议立即生效。</p>

  <h4>一、定义</h4>
  <p>1．OpenChat开源协议（以下简称“本协议”）是指本协议中定义的使用、复制、分发和修改OpenChat项目的条款和条件。</p>
  <p>2．“我们”是指浪潮电子信息产业股份有限公司。</p>
  <p>3．“许可方”是指授予许可的版权所有者或版权所有者实体，包括可能对项目和/或被分发项目拥有权利的个人或实体。</p>
  <p>4．“您”（或“您的”）是指行使本协议许可授予的权限和/或出于任何目的在任何领域使用项目的个人或法人实体，属于本协议的被许可人。</p>
  <p>5．“项目”是指根据本协议可获得的OpenChat软件、代码和文档(及其任何部分)。</p>

  <h4>二、许可和限制</h4>
  <p>OpenChat项目的开源协议遵循Apache2.0开源协议，允许商业化使用，并且增加以下附加条款：</p>
  <p>
    1．OpenChat允许商业化使用，如使用OpenChat作为其他应用的后端服务或者将OpenChat作为公司的一个对话机器人应用。但是，您不得出于任何军事或非法目的使用、复制、修改、合并、发布、分发、复制或创建本项目。
  </p>
  <p>2．本项目“按原样”提供，不附带任何明示或默示的保证，包括适销性、无侵权性或特定用途的适用性等。我们不提供任何保证，也不承担任何对项目及其产生的任何输出的安全性或稳定性的责任。</p>
  <p>3．在任何情况下，我们对您不承担任何责任，包括但不限于因您使用或无法使用项目或其任何输出而引起的任何直接或间接、特殊或后果性损害，无论其原因如何。</p>
  <p>4．作为本项目的共享者，您应同意对于您贡献的代码：(1) 我们可以调整开源协议的严格或放宽程度。(2) 可用于商业目的。</p>

  <p>除此之外，所有其他权利和限制都遵循Apache License 2.0。如果需要更详细的信息，可以参考Apache License 2.0的完整版本。</p>

  <p>© 2024 浪潮信息</p>
  ---
  <p>根据Apache License 2.0(“许可协议”)许可;除非遵守许可协议，否则您不得使用此文件。您可以从以下网址获得许可协议的副本：</p>

  <p>http://www.apache.org/licenses/LICENSE-2.0</p>

  <p>除非适用法律要求或书面同意，根据本许可协议分发的软件项目均按“原样”分发，不附带任何明示或默示的保证或条件。请参阅许可协议以了解具体的许可权限和限制。</p>`,titleEN:"OpenChat Open Source License",en:`<h1>OpenChat Open Source License</h1>

  <p>Release Date: January 3rd, 2024</p>
  <p>Effective Date: January 3rd, 2024</p>

  <p>
    By clicking to agree or browsing or by using or distributing any portion or element of the OpenChat project, you will be deemed to have recognized and accepted the content of
    this Agreement, which is effective immediately.
  </p>

  <h4>1. Definitions</h4>
  <p>
    1.1．This OpenChat LICENSE AGREEMENT (this "Agreement") shall mean the terms and conditions for use, reproduction, distribution and modification of the project as defined by this
    Agreement.
  </p>
  <p>1.2．"We"(or "Us") shall mean IEIT SYSTEMS.</p>
  <p>1.3. “Licensor” means any person or entity that distributes its Work.</p>
  <p>
    1.4．"You" (or "Your") shall mean a natural person or legal entity exercising the rights granted by this Agreement and/or using the project for any purpose and in any field of
    use.
  </p>
  <p>1.5． "Project" shall mean, collectively, OpenChat’s codes and Documentation (and any portion thereof) made available under this Agreement.</p>

  <h4>2. Grant of Rights and Limitation of Liability</h4>
  <p>The OpenChat project is licensed under the Apache License 2.0, with the following additional conditions:</p>
  <p>
    2.1．OpenChat is permitted to be used for commercialization, such as using OpenChat as a "backend-as-a-service" for your other applications, or delivering it to enterprises as an
    chatbot application. However,you are not permitted to use, copy, modify, merge, publish, distribute, sublicense, or create works based on this project for any military or illegal
    purposes.
  </p>
  <p>
    2.2．THE PROJECT ARE PROVIDED "AS IS" WITHOUT ANY EXPRESS OR IMPLIED WARRANTY OF ANY KIND INCLUDING WARRANTIES OF MERCHANTABILITY, NONINFRINGEMENT, OR FITNESS FOR A PARTICULAR
    PURPOSE. WE MAKE NO WARRANTY AND ASSUME NO RESPONSIBILITY FOR THE SAFETY OR STABILITY OF THE PROJECT AND ANY OUTPUT THEREFROM.
  </p>
  <p>
    2.3．IN NO EVENT SHALL WE BE LIABLE TO YOU FOR ANY DAMAGES, INCLUDING, BUT NOT LIMITED TO ANY DIRECT, OR INDIRECT, SPECIAL OR CONSEQUENTIAL DAMAGES ARISING FROM YOUR USE OR
    INABILITY TO USE THE PROJECT OR ANY OUTPUT OF IT, NO MATTER HOW IT’S CAUSED.
  </p>
  <p>
    2.4. As a contributor, you should agree that your contributed code:(1) The producer can adjust the open-source agreement to be more strict or relaxed.(2) Can be used for
    commercial purposes
  </p>

  <p>© 2024 IEIT SYSTEMS.</p>

  <p>
    Apart from this, all other rights and restrictions follow the Apache License 2.0. If you need more detailed information, you can refer to the full version of Apache License 2.0.
  </p>

  -----
  <p>Licensed under the Apache License, Version 2.0 (the "License");you may not use this file except in compliance with the License.You may obtain a copy of the License at</p>

  <p>http://www.apache.org/licenses/LICENSE-2.0</p>

  <p>
    Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.See the License for the specific language governing permissions and limitations under the License.
  </p>`},dt={titleCN:"源2.0模型许可协议",cn:`<h1>源2.0模型许可协议</h1>

  <p>发布日期:2023年11月26日</p>
  <p>生效日期:2023年11月26日</p>

  <p>点击或浏览或使用或分发源2.0材料的任何部分，您将被视为已经承认并接受本协议的内容，本协议立即生效。</p>

  <h4>一、定义</h4>
  <p>源2.0模型许可协议（以下简称“本协议”）是指本协议中定义的使用、复制、分发和修改源2.0模型材料的条款和条件。</p>
  <p>“我们”是指浪潮电子信息产业股份有限公司。</p>
  <p>“许可方”是指授予许可的版权所有者或版权所有者实体，包括可能对模型和/或被分发模型拥有权利的个人或实体。</p>
  <p>“您”（或“您的”）是指行使本协议许可授予的权限和/或出于任何目的在任何使用领域使用模型的个人或法人实体，属于本协议的被许可人。</p>
  <p>“第三方”是指不受我们或您共同控制的个人、法人实体或非法人组织。</p>
  <p>“模型”是指任何附带的基于机器学习的组件（包括检查点），包括学习的权重、参数（包括优化器状态）。</p>
  <p>“源2.0模型”是指源2.0-2B模型、 源2.0-51B模型和源2.0base-102b模型。</p>
  <p>“数据”是指与源2.0模型一起使用的数据集中提取的信息和/或内容的集合，包括用于预训练、微调训练或以其他方式评估模型的数据，数据中可能会包含个人信息或非个人信息。</p>
  <p>
    “个人信息”是指以电子或者其他方式记录的能够单独或者与其他信息结合识别特定自然人身份或者反映特定自然人活动情况的各种信息，包括姓名、身份证件号码、通信通讯联系方式、住址、账号密码、财产状况、行踪轨迹等。不包括匿名化处理后的信息。
  </p>
  <p>“材料”是指根据本协议可获得的源2.0模型和文档(及其任何部分)。</p>
  <p>
    “模型衍生品”是指对源2.0模型的所有修改、基于源2.0模型的工作，或通过将源2.0模型的权重、参数、激活或输出模式转移到其他模型而创建或初始化的任何其他模型，包括但不限于需要使用中间数据表示的提取方法或基于源2.0模型生成合成数据来训练其他模型的方法。
  </p>
  <p>
    “分发”是指向第三方传输、复制、发布或以其他方式共享模型或模型衍生品，包括将模型作为通过本地网络或其他远程方式（例如基于 API 或 Web 访问的任何云平台、 SaaS软件或
    PaaS软件）提供的托管服务。
  </p>
  <p>“商业用途”是指使用源2.0模型，直接或间接为法律实体或个人进行运营、推广或产生收入，或用于任何其他盈利目的。</p>
  <h4>二、许可和限制</h4>
  <p>根据本协议的条款和条件，许可方特此授予您非排他性、全球性、不可转让、不可再许可、可撤销、免版税的版权许可，但您必须满足如下许可限制条件：</p>
  <p>1.您不得出于任何军事或非法目的使用、复制、修改、合并、发布、分发、复制或创建源2.0模型及其衍生作品的全部或部分。</p>
  <p>
    2.您对源2.0模型的使用和修改（包括使用源2.0模型的输出或者基于源2.0模型得到的模型衍生品）不得违反任何国家的法律法规，尤其是中华人民共和国的法律法规，不得侵犯任何第三方的合法权益，包括但不限于肖像权、名誉权、隐私权等人格权，著作权、专利权、商业秘密等知识产权，或者其他财产权益。
  </p>
  <h4>三、知识产权</h4>
  <p>1.源2.0模型的所有权及其相关知识产权，由我们单独所有。</p>
  <p>2.在遵守本协议条款和条件的前提下，对于您制作的任何模型衍生作品和对材料的修改，您可以主张该部分的知识产权。</p>
  <p>
    3.如果您对我们或任何实体提起诉讼或其他程序(包括但不限于诉讼中的交叉索赔或反索赔)，声称源2.0模型的材料或其任何输出或前述内容的任何部分侵犯了您拥有的任何知识产权或其他权利，则根据本协议授予您的所有许可将在此类诉讼或其他程序开始或提起之日终止。
  </p>
  <p>
    4.除非是为了满足本协议项下的通知要求，或者是为了在描述和再分发材料时进行合理和惯常的使用，否则未经许可方书面同意，您不得使用许可方任何商标、服务标记、商号、域名、网站名称或其他显著品牌特征（以下统称为"标识"），包括但不限于明示或暗示您自身为“许可方”。未经许可方书面同意，您不得将本条款前述标识以单独或结合的任何方式展示、使用或申请注册商标、进行域名注册等，也不得向他人明示或暗示具有展示、使用、或以其他方式处理这些标识的权利。若您违反本协议使用许可方上述标识等给许可方或他人造成损失的，由您承担全部法律责任。
  </p>
  <h4>四、免责声明及责任限制</h4>
  <p>
    1.针对本协议中的源2.0模型，“按原样”提供，我们不提供任何明示、暗示的保证，包括但不限于：关于所有权的任何保证或条件、关于适销性的保证或条件、适用于任何特定目的保证或条件、任何时间关于源2.0模型不侵权的任何类型的保证、以及因任何交易过程和/或贸易使用（如建议书、规范或样品）而产生的任何保证。您将对通过使用、复制、分发和修改模型等方式利用源2.0模型所产生的风险与后果，独自承担全部责任。
  </p>
  <p>2.对于因您使用或分发材料而引起的或与之相关的任何第三方索赔，若由此导致我们遭受损失，您应当向我们承担全部赔偿责任。</p>
  <p>
    3.本协议所称损失包括但不限于下列损失（无论此类损失或损害是不可预见的、可预见的、已知的或其他的）：(i)收入损失;(ii)实际或预期利润损失；(ii)货币使用损失；(iv)预期可节约成本的损失；(v)业务损失；(vi)机会损失；(vii)商誉、声誉损失；(viii)软件的使用损失；或(x)任何间接、附带的特殊或间接损害损失。
  </p>
  <p>
    4.您充分知悉并理解同意，源2.0模型中可能包含个人信息。您承诺将遵守所有适用的法律法规进行个人信息的处理，特别是遵守《中华人民共和国个人信息保护法》的相关规定。请注意，我们给予您使用源2.0模型的许可，并不意味着您已经获得处理相关个人信息的合法性基础。您作为独立的个人信息处理者，需要保证在处理源2.0模型中可能包含的个人信息时，完全符合相关法律法规的要求，包括但不限于获得个人信息主体的授权同意等，并应当独自承担由此可能产生的任何风险和后果。
  </p>
  <p>
    5.您充分理解并同意，许可方有权依据合理判断对违反有关法律法规或本协议规定的行为进行处理，对您的违法违规行为采取适当的法律行动，并依据法律法规保存有关信息向有关部门报告等，您应当独自承担由此而产生的一切法律责任。
  </p>
  <h4>五、协议期限</h4>
  <p>1.本协议的期限自您接受本协议或访问材料之日起开始，并将持续完全有效，直至根据本协议的条款和条件终止。</p>
  <p>
    2.如果您违反本协议的任何条款或条件，我们可以随时单方终止本协议。本协议终止后，您必须删除并停止使用源2.0模型的材料。本协议终止后，第四条免责声明及责任限制和第六条争议解决仍然有效。
  </p>

  <h4>六、争议解决</h4>
  <p>1. 我们在法律法规许可的范围内对本协议条款享有最终解释权。</p>
  <p>
    2. 本协议的订立、生效、解释、履行、修改和终止，使用源2.0大模型以及争议的解决均适用中华人民共和国大陆地区（仅为本协议之目的，不包括香港、澳门和台湾）法律，并排除冲突法的适用。
  </p>
  <p>3. 因使用源2.0模型而发生的任何争议，各方应当首先通过友好协商的方式加以解决。协商不成时，应当向许可方所在地人民法院提起诉讼。</p>

  <h4>七、其他</h4>
  <p>请注意，本协议可能会更新到更全面的版本。有关许可和版权的任何问题，请通过 air_service@ieisystem.com与我们联系。</p>
  `},Bo=["innerHTML"],Fo={__name:"Disclaimer",emits:["close"],setup(e,{expose:t,emit:n}){const i=ft().getLanguage(),d=C(!1),m=C(""),v=C(""),s=n;function l(u){d.value=!0,u==="yuanChat"?(m.value=i==="zh-CN"?je.titleCN:je.titleEN,v.value=i==="zh-CN"?je.cn:je.en):u==="yuanModel"&&(m.value=dt.titleCN,v.value=dt.cn)}function c(){d.value=!1,s("close")}return t({show:l}),(u,b)=>{const w=Ie,E=qt;return p(),N(E,{visible:g(d),"onUpdate:visible":b[0]||(b[0]=D=>Be(d)?d.value=D:null),onHide:c,closable:!1,closeOnEscape:!1,style:{width:"50vw"}},{footer:R(()=>[I(w,{onClick:c,label:u.$t("lang.confirm")},null,8,["label"])]),default:R(()=>[r("div",{innerHTML:g(v)},null,8,Bo)]),_:1},8,["visible"])}}},Ho={class:"flex justify-between items-center w-full h-12 py-2 px-4"},Wo={class:"plugins flex items-center h-full gap-2"},Xo=["onClick"],Yo={class:"tools"},$o={class:"export-btn"},Jo={__name:"Toolbar",emits:["exportMessage"],setup(e,{emit:t}){const n=pt(),o=De(),i=V(()=>o.pluginList);async function d(s,l,c){console.log(c.currentTarget),l&&!i.value.every(u=>!u.session_status)?n.require({target:c.currentTarget,message:zt("lang.pluginActiveTip"),icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-sm",accept:async()=>{await o.changePluginStatus(s,l),await o.getSessionPluginList()},reject:()=>{}}):(await o.changePluginStatus(s,l),await o.getSessionPluginList())}const m=t;function v(){m("exportMessage")}return o.getSessionPluginList(),(s,l)=>{const c=Ie,u=We("tooltip");return p(),h("div",Ho,[r("div",Wo,[(p(!0),h(z,null,se(g(i),b=>Ce((p(),h("button",{key:b.id,class:q(["text-xl bg-transparent hover:bg-blue-100 hover:bg-opacity-50 dark:hover:bg-slate-700 p-2 rounded flex items-center justify-center border-none",b.session_status?"text-blue-400":"text-slate-500"]),onClick:w=>d(b,!b.session_status,w),type:"button"},[I(vt,{icon:b.plugin_logo},null,8,["icon"])],10,Xo)),[[u,b.plugin_name,void 0,{top:!0}]])),128))]),r("div",Yo,[r("div",$o,[Ce(I(c,{class:"text-xl",size:"large",icon:"pi pi-file-export",text:"",rounded:"",onClick:v},null,512),[[u,s.$t("lang.exportMessages"),void 0,{top:!0}]])])])])}}},Zo={class:"setting_container shadow-md rounded-3xl h-full shrink grow bg-transparent dark:bg-slate-800 p-4 flex flex-col items-start justify-start"},Go={class:"settings w-full h-full grow shrink space-y-4 mt-6 overflow-y-auto px-3 pb-2"},Ko={class:"font-bold text-lg title-items"},Qo={class:"plugin-component px-5"},es={key:0,class:"flex flex-col items-center justify-center pt-32"},ts={class:"text-slate-500 text-xl"},ns={__name:"Plugins",setup(e){const t=me(),n=De(),o=V(()=>(n.pluginList||[]).filter(s=>s.session_status)),i={preprocess_sensitive_filter:we(()=>xe(()=>import("./Sensitive-CrMfk-Jt.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),preprocess_web_argument:we(()=>xe(()=>import("./WebSearch-D60MhxJn.js"),__vite__mapDeps([11,5,1,2,4,3,12,9,13,6,7,8,14]))),retrievers:we(()=>xe(()=>import("./knowledges-DQOrPNcp.js"),__vite__mapDeps([15,1,2,12,3,16,5,4,13,9,7,8,17,18,19,20]))),chat_files_retrievers:we(()=>xe(()=>import("./DocChat-CPJOfEC_.js"),__vite__mapDeps([21,1,2,22,4,3,12,9,13,23,24,16,5,7,8,17,18,19]))),longcode:we(()=>xe(()=>import("./CodeAnalysis-zmBK5T45.js"),__vite__mapDeps([25,1,2,22,4,3,13])))};async function d(){await n.getSessionPluginList()}d();const m={},v=(s,l)=>{s&&(m[`${l.name}`]=s)};return(s,l)=>{const c=Je;return p(),h("div",Zo,[r("div",Go,[g(o).length?(p(!0),h(z,{key:0},se(g(o),u=>(p(),h("div",{class:"",key:u.plugin_id},[I(c,{align:"left",class:"mb-4"},{default:R(()=>[r("span",Ko,P(u.plugin_name),1)]),_:2},1024),r("div",Qo,[(p(),N(Xe(i[u.plugin_key]),{key:g(t).currentConversationId,ref_for:!0,ref:b=>v(b,u),"plugin-id":u.plugin_id},null,8,["plugin-id"]))])]))),128)):(p(),h(z,{key:1},[s.loadedModelId?T("",!0):(p(),h("div",es,[l[0]||(l[0]=r("i",{class:"pi pi-box text-3xl text-slate-500 mb-4"},null,-1)),r("div",ts,P(s.$t("lang.noPluginOpen")),1)]))],64))])])}}},os=Le(ns,[["__scopeId","data-v-657262fd"]]),ss={key:0,class:"code-analysis w-full py-2 px-8 bg-slate-100"},is={class:"flex items-center justify-between"},as={class:"recommends-list flex w-full flex-wrap divide-x divide-solid divide-slate-300"},ls=["onClick"],rs={class:"action shrink-0 grow-0"},cs={__name:"CodeAnalysisRecommends",emits:["useRecommend"],setup(e,{emit:t}){const n=De(),o=V(()=>n.codeAnalysisOpen),i=C([]);function d(){return qo().then(s=>(i.value=s,s))}d();const m=t;function v(s){m("useRecommend",s)}return(s,l)=>{const c=Ie;return g(o)?(p(),h("div",ss,[r("div",is,[r("div",as,[(p(!0),h(z,null,se(g(i),(u,b)=>(p(),h("div",{class:"text-slate-500 text-sm border-clear px-4 cursor-pointer my-2",key:b,onClick:w=>v(u)},P(u),9,ls))),128))]),r("div",rs,[I(c,{icon:"pi pi-refresh",text:"",onClick:d})])])])):T("",!0)}}};var ht={exports:{}};(function(e,t){(function(n,o){o()})(ke,function(){function n(l,c){return typeof c>"u"?c={autoBom:!1}:typeof c!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),c={autoBom:!c}),c.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(l.type)?new Blob(["\uFEFF",l],{type:l.type}):l}function o(l,c,u){var b=new XMLHttpRequest;b.open("GET",l),b.responseType="blob",b.onload=function(){s(b.response,c,u)},b.onerror=function(){console.error("could not download file")},b.send()}function i(l){var c=new XMLHttpRequest;c.open("HEAD",l,!1);try{c.send()}catch{}return 200<=c.status&&299>=c.status}function d(l){try{l.dispatchEvent(new MouseEvent("click"))}catch{var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),l.dispatchEvent(c)}}var m=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof ke=="object"&&ke.global===ke?ke:void 0,v=m.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),s=m.saveAs||(typeof window!="object"||window!==m?function(){}:"download"in HTMLAnchorElement.prototype&&!v?function(l,c,u){var b=m.URL||m.webkitURL,w=document.createElement("a");c=c||l.name||"download",w.download=c,w.rel="noopener",typeof l=="string"?(w.href=l,w.origin===location.origin?d(w):i(w.href)?o(l,c,u):d(w,w.target="_blank")):(w.href=b.createObjectURL(l),setTimeout(function(){b.revokeObjectURL(w.href)},4e4),setTimeout(function(){d(w)},0))}:"msSaveOrOpenBlob"in navigator?function(l,c,u){if(c=c||l.name||"download",typeof l!="string")navigator.msSaveOrOpenBlob(n(l,u),c);else if(i(l))o(l,c,u);else{var b=document.createElement("a");b.href=l,b.target="_blank",setTimeout(function(){d(b)})}}:function(l,c,u,b){if(b=b||open("","_blank"),b&&(b.document.title=b.document.body.innerText="downloading..."),typeof l=="string")return o(l,c,u);var w=l.type==="application/octet-stream",E=/constructor/i.test(m.HTMLElement)||m.safari,D=/CriOS\/[\d]+/.test(navigator.userAgent);if((D||w&&E||v)&&typeof FileReader<"u"){var F=new FileReader;F.onloadend=function(){var L=F.result;L=D?L:L.replace(/^data:[^;]*;/,"data:attachment/file;"),b?b.location.href=L:location=L,b=null},F.readAsDataURL(l)}else{var Y=m.URL||m.webkitURL,k=Y.createObjectURL(l);b?b.location=k:location.href=k,b=null,setTimeout(function(){Y.revokeObjectURL(k)},4e4)}});m.saveAs=s.saveAs=s,e.exports=s})})(ht);var ds=ht.exports;const us={class:"w-full h-full shrink grow flex flex-row items-center justify-start overflow-auto"},ps={key:0,class:"file_container h-full w-full rounded-3xl shadow-md overflow-hidden"},fs={class:"file-title"},gs={class:"chat_container shrink grow h-full w-full overflow-auto"},ms={class:"chat w-full mx-auto dark:bg-slate-900 h-full overflow-hidden p-0 md:px-2 md:pt-2 bg-white"},vs={class:"flex flex-col items-center justify-start h-full"},hs={class:"chat_list flex-auto w-full h-full flex flex-col items-start justify-start overflow-hidden"},ys={class:"header border-solid border-t-0 border-r-0 border-l-0 border-b border-zinc-200 dark:border-zinc-700 h-16 w-full shrink-0 grow-0"},bs={class:"flex flex-row items-center justify-between w-full h-full px-4"},As={class:"left_trigger"},_s={class:"justify-self-start w-full model_selector h-full flex flex-row space-x-4 items-center justify-start"},ws={class:"flex flex-row space-x-4 items-center"},xs={key:0,class:"flex items-center gap-3"},ks=["alt","src"],Cs={class:"font-bold text-slate-600"},Ss={key:1},Is={class:"flex align-items-center gap-3"},Ls=["alt","src"],Os={class:"font-bold"},Ts={class:"w-28 text-right"},Ps={class:"right_trigger"},Es={class:"container flex flex-col items-start justify-start px-8 py-4"},Ns={class:"chat_input container bg-white dark:bg-slate-800 h-32 shrink-0 grow-0 w-full p-4 border border-zinc-200 dark:border-zinc-700 border-solid border-clear relative rounded-xl"},Vs={class:"flex flex-row items-center justify-start h-full"},Rs={class:"send_btn w-28 shrink-0 grow-0 h-full flex items-center justify-center"},Ms={class:"flex justify-between items-center px-2 text-slate-400 dark:text-slate-400",style:{"font-size":"12px"}},js={class:"tabs_container"},Us=15,Ds={__name:"Chat",setup(e){const t=ft(),n=Ue(),o=me(),i=Cn(),d=De(),m=V(()=>o.conversations),v=V(()=>o.currentConversationId),s=C([]),l=C(1),c=C(0);async function u(a=v.value){return await $t({session_id:a}).then(f=>f.resData.map(y=>({id:y.id,question_id:y.question_id,conversation_id:y.session_id,sender:y.role,content:y.text,think:y.think_text,think_cost:y.think_cost,time:y.create_time,refs:y.refs||[],recommend_question:y.recommend_question||[],feedback:y.like_type||0,model_pic:y.model_pic})).reduce((y,A)=>{if(A.sender==="user")y.push({question_id:A.question_id,sender:"user",content:[A]});else{const _=y.findIndex(S=>S.question_id===A.question_id&&S.sender==="system");_>-1?y[_].content.push(A):y.push({question_id:A.question_id,sender:"system",content:[A]})}return y},[]))}const b=V(()=>i.viewFileFlag),w=C(""),E=C(""),D=C("");function F(){const a=i.fileInfo;w.value=a.id,D.value=a.name,E.value=a.type,j(!0),J(!0)}function Y(){i.setFileView(!1),i.setFileInfo({})}ge(()=>b.value,a=>{a?Me(()=>{F()}):(j(!1),J(!1))});function k(a){console.log("changeConversation"),o.currentConversationId=a}async function L(){l.value=1,console.log("createConversation"),console.log(m.value,m.value[0]);const a=m.value[0].id;if(!(await u(a)).length){k(a);return}const{id:y}=await o.addConversation();await o.getConversationList(),k(y)}async function ie(a){await o.deleteConversation(a)}async function te(a,f){await o.editConversationName(a,f)}const W=C(null);function H(){Me(()=>{W.value&&(W.value.scrollTop=W.value.scrollHeight)})}const O=C("");let K=new AbortController,$="";const ae=C("");function re(a){var y,A,_;console.log("addMessage");const f=s.value.length;return console.log("messages.value[length - 1]?.isLoading",(y=s.value[f-1])==null?void 0:y.isLoading),(A=s.value[f-1])!=null&&A.isLoading?(console.log("isLoading",a,s.value[f-1]),(_=s.value[f-1].content)!=null&&_.length||(s.value[f-1]={sender:a.sender||"",question_id:a.question_id||"",content:[Object.assign({},a,{time:new Date().getTime()})]},console.log(s.value[f-1]))):s.value.push({sender:a.sender||"",question_id:a.question_id||"",content:[Object.assign({},a,{time:new Date().getTime()})]}),console.log("messages.value[length - 1]",s.value[f-1]),a.id}function ce(a,f,{...y}){const A=s.value.findIndex(_=>_.question_id===f&&_.sender==="system");if(console.log("index",A),A>-1){console.log("messages.value[index].content",s.value[A].content);const _=s.value[A].content.findIndex(S=>S.id===a);s.value[A].content[_]=Object.assign(s.value[A].content[_],y)}else s.value.push({sender:"system",question_id:f,content:[y]});s.value[A-1]&&!s.value[A-1].question_id&&(s.value[A-1].question_id=f)}function Oe(a){return new Promise(()=>{K=new AbortController,ct("/chat/sse/subscribe",{signal:K.signal,params:a,onmessage:async f=>{if(M.value==="STOPPED")return;const y=!$;try{if(!f.data)return;const A=JSON.parse(f.data),{flag:_,resData:S}=A;if(console.log(S),_){const{message:ne,finish_flag:oe,id:B,question_id:x,model_pic:Z,think_text:G,think_cost:X}=S;oe||($=B);const be=S.refs||[],Ae=S.recommend_question||[];c.value=S.tokens||0;const Re={conversation_id:v.value,sender:"system",id:B,question_id:x,content:ne,think:G,think_cost:X,feedback:0,refs:be,model_pic:Z,recommend_question:Ae};y?(re(Re),ae.value=B):ce(ae.value,x,{content:ne,think:G,think_cost:X,refs:be,recommend_question:Ae,id:B}),console.log("messages.value",s.value),s.value[s.value.length-1].typing=!oe,H(),oe&&(o.getConversationList(),M.value="FINISHED",$="")}}catch(A){console.error(A)}},onerror(f){const y={conversation_id:v.value,sender:"BOT",content:"ERROR"};throw re(y),M.value="FINISHED",new Error(f)}})})}function Te(a,f){te(a,f)}async function ve(){var S;if(!O.value)return;M.value="LOADING";const a={conversation_id:v.value,sender:"user",content:O.value};re(a),console.log(d.getLocalPluginStatus("retrievers"));const f=d.getLocalPluginStatus("retrievers")?i.getKbData()||{}:{},y=d.getLocalPluginStatus("chat_files_retrievers")?{file:i.getChatFileData(),knowledge_id:o.currentConversationId}:{};console.log("kbData",f);const A={message:O.value,session_id:v.value,model_id:Ve.value,reference_info:{model_precise:(S=n.loadedModel)==null?void 0:S.precise_load,...f,...y}};s.value.length===1&&Te(v.value,O.value.substring(0,Us)),O.value="",s.value.push({isLoading:!0,sender:"system"}),H(),await Oe(A)}const le=C(""),de=C("");async function Pe(a){M.value="LOADING",console.log(a);let f=s.value.findIndex(_=>_.question_id===a&&_.sender==="system");const y={content:"",sender:"system",conversation_id:v.value};if(f===-1){const _=s.value.findIndex(S=>S.question_id===a);s.value.splice(_+1,0,{sender:"system",isLoading:!1,question_id:a,content:[{conversation_id:v.value,sender:"system",id:"",question_id:a,content:"",feedback:0,refs:[],recommend_question:[]}]})}const A=s.value.findIndex(_=>_.question_id===a&&_.sender==="system");console.log(A),s.value[A].isLoading=!0,f>-1&&s.value[f].content.push(y),K=new AbortController,await ct("/chat/sse/re-subscribe",{signal:K.signal,params:{question_id:a},onmessage:async _=>{if(M.value==="STOPPED")return;const S=!de.value;try{if(!_.data)return;const ne=JSON.parse(_.data),{flag:oe,resData:B}=ne;if(console.log("res",B),oe){const{message:x,finish_flag:Z,id:G,question_id:X,think_text:be,think_cost:Ae}=B;Z||(console.log("question_id",X),le.value=X,de.value=G);const Re=B.refs||[],tt=B.recommend_question||[];c.value=B.tokens||0;const kt={conversation_id:v.value,sender:"system",id:G,question_id:X,content:x,think:be,think_cost:Ae,feedback:0,refs:Re,recommend_question:tt};if(console.log("isNewMessage",S),S){console.log("regeneratingQuestionId.value",le.value);const _e=s.value.findIndex(nt=>nt.question_id===le.value&&nt.sender==="system");console.log("new index",_e);const Ct=s.value[_e].content.length;s.value[_e].content[Ct-1]=Object.assign({},kt,{time:new Date().getTime()}),s.value[_e].isLoading=!1,console.log(s.value[_e].isLoading),ae.value=G}else ce(ae.value,X,{content:x,think:be,think_cost:Ae,refs:Re,recommend_question:tt,id:G});s.value[s.value.length-1].typing=!Z,Z&&(o.getConversationList(),M.value="FINISHED",le.value="",de.value="")}}catch(ne){console.error(ne)}}})}async function he(){$&&(await Gt($),$=""),K&&K.abort(),M.value="STOPPED",H()}const M=C("");ge(()=>v.value,async a=>{M.value==="LOADING"&&await he(),a&&(s.value=await u(),await Me(()=>{H()}))},{immediate:!0});function Ee(a){if(!a.shiftKey&&a.keyCode===13){if(a.cancelBubble=!0,a.stopPropagation(),a.preventDefault(),M.value==="LOADING")return;ve()}}function ue(a){O.value=a}async function Ne(a,f,y){function A(S=""){return S.replace(new RegExp("__bot","g"),"").replace(new RegExp("__user","g"),"")}const _=s.value.find(S=>S.question_id===f&&S.sender==="system").content.find(S=>S.id===a).feedback||0;console.log("currentFeedback",_),_===y&&(y=0),ce(a,f,{feedback:y}),await Zt({id:A(a),like_type:y}),s.value=await u()}const ye=V(()=>t.conversationCollapsed),pe=V(()=>t.settingCollapsed);function j(a){t.setConversationCollapsed(a)}function J(a){t.setSettingCollapsed(a)}function yt(){Promise.allSettled([n.getModelList(),n.getLoadedModel()])}yt();const Ze=C(!1);async function Ge(a){Ze.value=!0;const{id:f}=a;try{await n.loadModel(a),await bt()}catch(y){console.error(`Failed to load model ${f}:`,y)}finally{Ze.value=!1}}async function bt(){for(;;){if(await n.getModelLoadStatus()===12){await n.getLoadedModel();break}await new Promise(f=>setTimeout(f,1e3))}}const qe=V(()=>n.modelList),Ve=V({get:()=>{var a;return((a=n.loadedModel)==null?void 0:a.id)||""},set:async a=>{await Ge({id:a})}});async function At({value:a}){var f;console.log("precise",a),await Ge({id:(f=n.loadedModel)==null?void 0:f.id,precise:a})}const ze=C(!1),Ke=C();function Qe(a){ze.value=!0,Me(()=>{Ke.value.show(a)})}function _t(a){return Jt({question_id:a}).then(async()=>{s.value=await u()})}function wt(){Yt({session_id:v.value}).then(a=>{console.log("res",a);const f=new Blob([a.data],{type:"text/markdown"});console.log("blob",f);const y=a.headers["content-disposition"];let A="default-filename.md";if(y){console.log("in contentDisposition");const _=y.match(/filename\*=[^'']+''(.+)/);console.log("filenameMatch",_),_&&_.length>1&&(A=decodeURIComponent(_[1])),console.log("filename",A)}ds.saveAs(f,A)})}const et=({id:a,name:f})=>te(a,f);Bt(()=>{ee.on("conversation:change",k),ee.on("conversation:create",L),ee.on("conversation:rename",et),ee.on("conversation:delete",ie)}),Ft(()=>{ee.off("conversation:change",k),ee.off("conversation:create",L),ee.off("conversation:rename",et),ee.off("conversation:delete",ie)});function xt(a){O.value=a}return(a,f)=>{var oe,B;const y=Ie,A=gt,_=Ot,S=Lt,ne=We("tooltip");return p(),h("div",us,[g(b)?(p(),h("div",ps,[I(A,{class:"file-panel h-full w-full ml-1"},{header:R(()=>[Ce((p(),h("div",fs,[Q(P(g(D)),1)])),[[ne,g(D)]])]),icons:R(()=>[I(y,{text:"",icon:"pi pi-times",onClick:Y})]),default:R(()=>[g(w)?(p(),N(on,{ref:"fileViewerRef",key:g(w),fileId:g(w),fileType:g(E)},null,8,["fileId","fileType"])):T("",!0)]),_:1})])):T("",!0),r("div",gs,[r("div",ms,[r("div",vs,[r("div",hs,[r("div",ys,[r("div",bs,[r("div",As,[I(y,{icon:`pi ${g(ye)?"pi-chevron-right":"pi-chevron-left"}`,rounded:"",text:"",onClick:f[0]||(f[0]=x=>j(!g(ye)))},null,8,["icon"])]),r("div",_s,[r("div",ws,[I(_,{class:"border-none font-semibold",modelValue:g(Ve),"onUpdate:modelValue":f[1]||(f[1]=x=>Be(Ve)?Ve.value=x:null),options:g(qe),optionLabel:"name",optionValue:"id",placeholder:a.$t("lang.loadModelNeeded")},{value:R(x=>{var Z,G;return[x.value?(p(),h("div",xs,[r("img",{alt:x.value.label,class:"w-6 h-6 rounded-full",src:(Z=g(qe).find(X=>X.id===x.value))==null?void 0:Z.model_pic},null,8,ks),r("div",Cs,P((G=g(qe).find(X=>X.id===x.value))==null?void 0:G.name),1)])):(p(),h("span",Ss,P(x.placeholder),1))]}),option:R(x=>[r("div",Is,[r("img",{class:"w-6 h-6 rounded-full",alt:x.option.name,src:x.option.model_pic},null,8,Ls),r("div",Os,P(x.option.name),1)])]),_:1},8,["modelValue","options","placeholder"])]),r("div",Ts,[I(_,{options:((oe=g(n).loadedModel)==null?void 0:oe.precise_option)||[],onChange:At,"model-value":(B=g(n).loadedModel)==null?void 0:B.precise_load},null,8,["options","model-value"])])]),r("div",Ps,[I(y,{icon:`pi ${g(pe)?"pi-chevron-left":"pi-chevron-right"}`,rounded:"",text:"",onClick:f[2]||(f[2]=x=>J(!g(pe)))},null,8,["icon"])])])]),g(s).length?(p(),h("div",{key:1,class:"chat_items h-full mx-auto w-full grow shrink overflow-auto relative group",ref_key:"RefChatList",ref:W},[r("div",Es,[(p(!0),h(z,null,se(g(s),(x,Z)=>(p(),N(Lo,{key:Z,sender:x.sender,content:x.content,"is-loading":x.isLoading,typing:x.typing,questionId:x.question_id,onSendFeedback:Ne,onUseRecommend:ue,onRegenerate:Pe,onDeleteChatItem:_t,onCopyMessage:xt},null,8,["sender","content","is-loading","typing","questionId"]))),128))])],512)):(p(),N(Ro,{key:0,onUseRecommend:ue})),I(Jo,{class:"shrink-0 grow-0",onExportMessage:wt})]),I(cs,{onUseRecommend:ue}),r("div",Ns,[r("div",Vs,[I(S,{modelValue:g(O),"onUpdate:modelValue":f[3]||(f[3]=x=>Be(O)?O.value=x:null),class:"w-full h-full shrink grow resize-none outline-none border-none shadow-none text-lg leading-7 tracking-wider text-slate-500 placeholder-slate-400",style:{"box-shadow":"none"},placeholder:a.$t("lang.inputPlaceholder"),onKeydown:Ht(Ee,["enter"])},null,8,["modelValue","placeholder"]),r("div",Rs,[g(M)==="LOADING"&&g($)?(p(),N(y,{key:0,onClick:he,icon:"pi pi-stop",severity:"danger",raised:"",rounded:"","aria-label":"Send"})):(p(),N(y,{key:1,disabled:g(M)==="LOADING",onClick:ve,icon:"pi pi-send",severity:"primary",raised:"",rounded:"","aria-label":"Send"},null,8,["disabled"]))])])]),r("div",Ms,[Q(P(a.$t("lang.disclaimer"))+" ",1),I(y,{link:"",onClick:f[4]||(f[4]=x=>Qe("yuanModel")),class:"text-slate-400 dark:text-slate-400",style:{"font-size":"12px"}},{default:R(()=>f[9]||(f[9]=[Q(" 源2.0模型开源许可协议 ")])),_:1}),Q(" "+P(a.$t("lang.and"))+" ",1),I(y,{link:"",onClick:f[5]||(f[5]=x=>Qe("yuanChat")),class:"text-slate-400 dark:text-slate-400",style:{"font-size":"12px"}},{default:R(()=>f[10]||(f[10]=[Q(" OpenChat开源许可协议 ")])),_:1}),f[11]||(f[11]=Q(" 。 "))])])])]),r("div",{class:q(["shrink-0 grow-0 h-full transition-all duration-300 flex flex-col relative",g(pe)?["w-0","pl-0","overflow-hidden"]:["w-[320px]",""]])},[r("div",js,[r("div",{class:q(["cursor-pointer shadow-sm tracking-widest font-bold tabs-item",[g(l)===1?"tabs-item-active bg-white dark:bg-slate-800 dark:text-slate-200":"bg-slate-50 dark:bg-gray-700 text-slate-400"]]),style:{"z-index":"3"},onClick:f[6]||(f[6]=x=>l.value=1)},[f[12]||(f[12]=r("i",{class:"pi pi-cog mb-1"},null,-1)),Q(P(a.$t("lang.setting")),1)],2),r("div",{class:q(["cursor-pointer shadow-sm tracking-widest font-bold tabs-item",[g(l)===2?"tabs-item-active bg-white dark:bg-slate-800 dark:text-slate-200":"bg-slate-50 dark:bg-gray-700 text-slate-400"]]),style:{"z-index":"1"},onClick:f[7]||(f[7]=x=>l.value=2)},[f[13]||(f[13]=r("i",{class:"pi pi-box mb-1"},null,-1)),Q(P(a.$t("lang.plugin")),1)],2)]),g(l)===1?(p(),N(Wn,{key:0})):T("",!0),g(l)===2?(p(),N(os,{key:1})):T("",!0)],2),g(ze)?(p(),N(Fo,{key:1,ref_key:"disclainmerModelRef",ref:Ke,onClose:f[8]||(f[8]=x=>ze.value=!1)},null,512)):T("",!0)])}}},qs=Le(Ds,[["__scopeId","data-v-42603b9c"]]),Gs=Object.freeze(Object.defineProperty({__proto__:null,default:qs},Symbol.toStringTag,{value:"Module"}));export{Gs as C,Cn as u};
