import{b as F}from"./slider.esm-BAPKB8wQ.js";import{a as R}from"./inputnumber.esm-CIhko8if.js";import{S as T,O as z,P as W,ah as G,r as b,f as H,e as p,c as I,o as y,a as s,l as O,t as u,d,b as l,x as h,w as J,m as Q,s as X,j as k,V as Y}from"./index-B9s1B9jQ.js";import{_ as Z,s as ee}from"./_plugin-vue_export-helper-D8ncxyMm.js";import{s as te}from"./dropdown.esm-C8QGVjDp.js";import{u as se}from"./dayjs.min-BF7iIa5r.js";import{g as le}from"./knowledge-RiB-jk2J.js";import{c as ae,b as oe,a as x,u as ie}from"./vee-validate-Ce0Yf3uk.js";import{M as D}from"./Markdown-CsFcuW9P.js";function ne(i){return T({url:"/plugin-param/web-search/list",method:"get",params:i})}function re(i){return T({url:`/plugin-param/web-search/update/${i.session_id}`,method:"put",data:i})}const de=z("webSearch",()=>{const i=W({}),f=se();async function g(_){const{resData:m}=await ne({session_id:f.currentConversationId,plugin_id:_});return i.serper_key=m.serper_key,i.embedding_model_path=m.embedding_model_path,i.retrieve_topk=m.retrieve_topk,i.template=m.template,m}return{params:i,getParams:g,setParam:_=>re(Object.assign({},_,{session_id:f.currentConversationId}))}}),me={class:"space-y-4 flex flex-col w-full items-center tabs-item"},_e={class:"w-full flex flex-col items-start justify-between"},ue={class:"label text-slate-500 dark:text-slate-400 font-semibold"},ce={class:"flex w-full flex-col items-start justify-start mt-1"},pe={class:"text-red-400 mt-1"},be={key:0,class:"w-full flex flex-col items-start justify-between"},fe={class:"label text-slate-500 dark:text-slate-400 font-semibold"},ve={class:"flex w-full flex-col items-start justify-start mt-1"},ge={class:"text-red-400 mt-1"},we={class:"w-full flex flex-col items-start justify-between"},ye={class:"label shrink-0 w-48 text-slate-500 dark:text-slate-400 font-semibold"},he={class:"content-box"},ke={class:"content-box"},xe={class:"flex w-full flex-col items-start justify-start mt-1"},Se={class:"text-red-400 mt-1"},Ve={class:"w-full flex flex-col items-start justify-between"},Pe={class:"label shrink-0 w-48 text-slate-500 dark:text-slate-400 font-semibold"},Ce={class:"flex w-full flex-row items-center justify-start mt-1 space-x-4"},$e={class:"w-full flex flex-col items-start justify-between"},je={class:"label shrink-0 w-48 text-slate-500 dark:text-slate-400 font-semibold"},Ie={class:"flex flex-row items-center justify-start mt-1 space-x-4"},Oe=`
  ### 推荐下载模型
\`\`\`bash
  ollama run nomic-embed-text
\`\`\`
  ### ollama安装流程

  #### 步骤 1：在本地安装并启动 Ollama

  确保您的计算机上已安装 Ollama。如果尚未安装，请访问[官方网站](https://ollama.com/download) 进行下载和安装。

  #### 步骤 2：配置 Ollama 的跨域访问

  由于浏览器安全限制，您需要配置 Ollama 的跨域访问权限，以确保其正常运行。

  1. 在 Windows 上，打开**控制面板**，并编辑系统环境变量。
  2. 创建一个新的环境变量，命名为\`OLLAMA_ORIGINS\`（适用于当前用户）。
  3. 将该变量的值设置为\`*\`，然后点击 **OK/Apply**以保存更改。

  #### 步骤 3：拉取最新的模型

  在终端中运行以下命令下载模型：
\`\`\`bash
ollama pull nomic-embed-text
\`\`\`

  ### 其他Embedding模型推荐
\`\`\`bash
ollama run mxbai-embed-large
ollama run snowflake-arctic-embed
ollama run granite-embedding
\`\`\`

  `,De=`
请前往 ⚙️<strong>【设置】</strong>-<strong>【嵌入模型】</strong> 中，进行模型选择与设置
`,Te={__name:"WebSearch",props:{pluginId:{type:[String,Number],default:0},initParams:{type:Object,default:()=>null},isSettingDefault:{type:Boolean,default:!1}},setup(i,{expose:f}){const g=G(),n=i,_=b([]),m=b(!1),v=b(!1);async function E(){var a;try{const t=await le();_.value=t.resData,(a=_.value)!=null&&a.length?e.embedding_model_id=_.value[0].id:v.value=!0}catch(t){console.error("获取模型失败:",t),v.value=!0}}E();const r=b("serper"),M=H(()=>ae({style_search:x().required(p("lang.noEmpty")),web_api_key:(r==null?void 0:r.value)==="bing_bs4"?null:x().required(p("lang.noEmpty")).label("Serper API Key"),embedding_model_id:x().required(p("lang.noEmpty")).label(p("lang.embedding_model_id")),retrieve_topk:oe().required(p("lang.noEmpty"))})),{defineField:w,handleSubmit:S,errors:c}=ie({validationSchema:M,initialValues:{style_search:"serper",web_api_key:"",embedding_model_id:"",retrieve_topk:3}});r.value=w("style_search")[0];const e=W({web_api_key:w("web_api_key")[0],embedding_model_id:w("embedding_model_id")[0],retrieve_topk:3,template:""}),V=de();async function P(){if(n.isSettingDefault)return r.value=n.initParams.style_search,e.web_api_key=n.initParams.web_api_key,e.embedding_model_path=n.initParams.embedding_model_path,e.retrieve_topk=n.initParams.retrieve_topk,e.template=n.initParams.template,n.initParams;{const a=await V.getParams(n.pluginId);r.value=a.style_search,e.web_api_key=a.web_api_key,e.embedding_model_id=a.embedding_model_id,e.retrieve_topk=a.retrieve_topk,e.template=a.template}}P();const N=b(["serper","bing_bs4"]),U=S(()=>{V.setParam({style_search:r.value,web_api_key:e.web_api_key,embedding_model_id:e.embedding_model_id,retrieve_topk:e.retrieve_topk,template:e.template,plugin_id:n.pluginId}).then(()=>{P(),g.add({severity:"success",summary:p("lang.saveSuccess"),life:3e3})})}),q=S(()=>({style_search:r.value,web_api_key:e.web_api_key,embedding_model_id:e.embedding_model_id,retrieve_topk:e.retrieve_topk,template:e.template,plugin_id:n.pluginId}));f({exposeSubmit:q});const B=()=>{window.open("https://serper.dev","_blank")};return(a,t)=>{const C=te,A=ee,$=X,j=Y,L=R,K=F;return y(),I("div",me,[s("div",_e,[s("div",ue,u(a.$t("lang.searchType")),1),s("div",ce,[d(C,{invalid:!!l(c).style_search,class:"w-full",options:N.value,modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=o=>r.value=o)},null,8,["invalid","options","modelValue"]),s("small",pe,u(l(c).style_search),1)])]),r.value!=="bing_bs4"?(y(),I("div",be,[s("div",fe,[t[8]||(t[8]=h(" API Key ")),s("a",{target:"_blank",class:"py-0.5 text-sm font-medium text-violet-500 underline decoration-zinc-500/20 underline-offset-4 hover:opacity-90",href:"#",onClick:J(B,["stop","prevent"])}," 点击获取 ")]),s("div",ve,[d(A,{invalid:!!l(c).web_api_key,class:"w-full border",type:"text",modelValue:l(e).web_api_key,"onUpdate:modelValue":t[1]||(t[1]=o=>l(e).web_api_key=o)},null,8,["invalid","modelValue"]),s("small",ge,u(l(c).web_api_key),1)])])):O("",!0),s("div",we,[s("div",ye,[h(u(a.$t("lang.embeddingModelPath"))+" ",1),d($,{text:"",icon:"pi pi-question-circle",onClick:t[2]||(t[2]=o=>m.value=!0),class:"h-5 !px-2"}),d(j,{visible:m.value,"onUpdate:visible":t[3]||(t[3]=o=>m.value=o),header:"请使用ollama下载模型",style:{width:"800px"},modal:!0},{default:k(()=>[s("div",he,[d(D,{content:Oe})])]),_:1},8,["visible"]),d(j,{visible:v.value,"onUpdate:visible":t[4]||(t[4]=o=>v.value=o),header:"未检测到可使用的【嵌入模型】",style:{width:"800px"},modal:!0},{default:k(()=>[s("div",ke,[d(D,{content:De})])]),_:1},8,["visible"]),s("div",xe,[d(C,{class:"w-full",invalid:!!l(c).embedding_model_id,options:_.value,modelValue:l(e).embedding_model_id,"onUpdate:modelValue":t[5]||(t[5]=o=>l(e).embedding_model_id=o),optionLabel:"name",optionValue:"id"},null,8,["invalid","options","modelValue"]),s("small",Se,u(l(c).embedding_model_id),1)])]),s("div",Ve,[s("div",Pe,u(a.$t("lang.sourceTopK")),1),s("div",Ce,[d(L,{class:"w-full",inputClass:"w-full border",modelValue:l(e).retrieve_topk,"onUpdate:modelValue":t[6]||(t[6]=o=>l(e).retrieve_topk=o),min:1,max:8},null,8,["modelValue"])])]),s("div",$e,[s("div",je,u(a.$t("lang.llmTemplate")),1),s("div",Ie,[d(K,{class:"w-full border leading-5",modelValue:l(e).template,"onUpdate:modelValue":t[7]||(t[7]=o=>l(e).template=o),rows:"3",cols:"30"},null,8,["modelValue"])])]),n.isSettingDefault?O("",!0):(y(),Q($,{key:0,class:"self-end",onClick:l(U)},{default:k(()=>[h(u(a.$t("lang.save")),1)]),_:1},8,["onClick"]))])])}}},Ke=Z(Te,[["__scopeId","data-v-01859a07"]]);export{Ke as default};
