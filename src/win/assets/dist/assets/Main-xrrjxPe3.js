import{u as G,r as L,c as d,o as s,a as e,b as u,F as D,t as j,w as N,d as w,i as F,n as U,e as C,f as $,g as J,h as q,j as A,s as O,k as E,l as V,m as S,p as I,q as K,v as Q,x as B,y as X,z as Y,A as W,B as P,K as ee}from"./index-B9s1B9jQ.js";import{u as H}from"./Markdown-CsFcuW9P.js";import{d as te,u as se}from"./dayjs.min-BF7iIa5r.js";import{s as ne,_ as oe}from"./_plugin-vue_export-helper-D8ncxyMm.js";import{s as ae}from"./dropdown.esm-C8QGVjDp.js";import{Z as le,K as ie,O as re,D as ce,B as ue,T as de,a as pe,b as fe}from"./Zhipu-9dQE5Qwi.js";const me={class:"flex flex-row items-center justify-start space-x-4"},ve={class:"name w-full shrink grow truncate font-bold text-slate-600 dark:text-slate-200 text-base"},ge={key:0,class:"time w-14 shrink-0 grow-0 text-slate-400 dark:text-slate-400 text-sm text-end"},he={key:1,class:"text-xl bg-transparent hover:bg-blue-100 hover:bg-opacity-50 dark:hover:bg-slate-700 p-2 rounded flex items-center justify-center border-none"},ye={class:"action w-14 shrink-0 grow-0 text-slate-400 dark:text-slate-500 text-sm flex flex-row items-center justify-end space-x-1"},we={__name:"ConversationItem",props:{name:{default:"",type:String},time:{default:0,type:Number},avatar:{default:"",type:String},active:{default:!1,type:Boolean},id:{default:"",type:[Number,String]}},emits:["editConversationName","deleteConversation","changeConversation","confirmChange"],setup(m,{emit:v}){const f=G(),n=m,o=v;function h(){o("changeConversation",n.id)}const a=L(!1),l=L("");function x(){a.value=!0,l.value=n.name}function g(){a.value=!1,l.value=""}function i(c){f.require({target:c.currentTarget,message:C("lang.deleteConversationConfirm"),icon:"pi pi-info-circle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-danger p-button-sm",rejectLabel:C("lang.cancel"),acceptLabel:C("lang.confirm"),accept:()=>{o("deleteConversation",n.id)},reject:()=>{}})}function y(){o("confirmChange",n.id,l.value),g()}return(c,t)=>{const _=ne;return s(),d("div",{class:U(["history_item p-2 w-full rounded-xl cursor-pointer",[m.active&&"bg-neutral-300 bg-opacity-40",!m.active&&"hover:bg-neutral-300 dark:hover:bg-blue-900"]]),onClick:h},[e("div",me,[u(a)?(s(),d(D,{key:1},[w(_,{class:"w-full shrink grow truncate font-bold text-slate-600 dark:text-slate-300",modelValue:u(l),"onUpdate:modelValue":t[1]||(t[1]=r=>F(l)?l.value=r:null)},null,8,["modelValue"]),e("div",ye,[e("div",{class:"p-1",onClick:N(y,["stop"])},t[4]||(t[4]=[e("i",{style:{"font-size":"12px"},class:"pi pi-check"},null,-1)])),e("div",{class:"p-1",onClick:N(g,["stop"])},t[5]||(t[5]=[e("i",{style:{"font-size":"12px"},class:"pi pi-times"},null,-1)]))])],64)):(s(),d(D,{key:0},[e("div",ve,j(m.name),1),m.active?(s(),d("div",he,[e("button",{class:"p-1 bg-transparent hover:bg-blue-100 hover:bg-opacity-50 dark:hover:bg-slate-700 rounded-full border-none flex items-center justify-center",onClick:N(x,["stop"])},t[2]||(t[2]=[e("i",{style:{"font-size":"12px"},class:"pi pi-pencil"},null,-1)])),e("button",{class:"p-1 bg-transparent hover:bg-blue-100 hover:bg-opacity-50 dark:hover:bg-slate-700 rounded-full border-none flex items-center justify-center ml-1",onClick:t[0]||(t[0]=r=>i(r))},t[3]||(t[3]=[e("i",{style:{"font-size":"12px"},class:"pi pi-trash"},null,-1)]))])):(s(),d("div",ge,j(u(te)(m.time).format("HH:mm")),1))],64))])],2)}}},_e={class:"history_container w-full h-full bg-transparent dark:bg-slate-800 pb-4 overflow-auto"},be={class:"h-full p-4 flex flex-col items-start justify-start"},xe={class:"action mt-2 shrink-0 grow-0 flex flex-row items-center justify-around w-full space-x-6 mb-4"},ke={class:"flex items-center justify-center gap-1 w-full"},Ce={class:"flex items-center justify-center gap-2 w-full"},$e=["src"],je={class:"history_item_list space-y-4 w-full grow shrink h-full mt-4 overflow-y-auto"},Ie={key:0,class:"text-slate-600 dark:text-slate-400 font-semibold ml-2 text-sm"},De={__name:"ConversationList",props:{conversations:{type:Array,default:()=>[]},currentConversationId:{type:[Number,String],default:""}},setup(m){const v=m;function f(c){const t=Date.now(),_=24*60*60*1e3,r={today:{label:C("lang.today"),sessions:[]},last3Days:{label:C("lang.recent3day"),sessions:[]},last7Days:{label:C("lang.recent7day"),sessions:[]},last30Days:{label:C("lang.recent30day"),sessions:[]},earlier:{label:C("lang.earlier"),sessions:[]}};return c.forEach(p=>{const b=p.update_time,k=(t-b)/_;k<1?r.today.sessions.push(p):k<3?r.last3Days.sessions.push(p):k<7?r.last7Days.sessions.push(p):k<30?r.last30Days.sessions.push(p):r.earlier.sessions.push(p)}),r}const n=$(()=>f(v.conversations)),o=J();async function h(c){o.name!=="chat"&&await g.replace({name:"chat"}),c!==v.currentConversationId&&setTimeout(()=>{I.emit("conversation:change",c)},1)}async function a(){console.log("createConversation"),o.name!=="chat"&&await g.replace({name:"chat"}),I.emit("conversation:create")}function l(c,t){I.emit("conversation:rename",{id:c,name:t})}async function x(c){o.name!=="chat"&&await g.replace({name:"chat"}),I.emit("conversation:delete",c)}const g=q();function i(){g.push({name:"assistant"})}const y=$(()=>"/yuan-chat/");return(c,t)=>{const _=O;return s(),d("div",_e,[e("div",be,[e("div",xe,[w(_,{onClick:a,class:"w-full shrink",severity:"contrast"},{default:A(()=>[e("div",ke,[t[0]||(t[0]=e("i",{class:"pi pi-plus"},null,-1)),e("span",null,j(c.$t("lang.newChat")),1)])]),_:1})]),w(_,{class:"w-full",severity:"secondary",onClick:i},{default:A(()=>[e("div",Ce,[e("img",{class:"w-6 h-6",src:`${u(y)}icons/icon/ai-technology (2).png`,alt:""},null,8,$e),t[1]||(t[1]=e("span",null,"智能助手应用",-1))])]),_:1}),e("div",je,[(s(!0),d(D,null,E(u(n),r=>(s(),d(D,{key:r.label},[r.sessions.length?(s(),d("div",Ie,j(r.label),1)):V("",!0),(s(!0),d(D,null,E(r.sessions,p=>(s(),S(we,{name:p.session_name,time:p.update_time,active:p.id===m.currentConversationId,id:p.id,key:p.id,onDeleteConversation:x,onChangeConversation:h,onConfirmChange:l},null,8,["name","time","active","id"]))),128))],64))),128))])])])}}},Se={class:"flex flex-col items-start justify-start w-full"},Ae={key:0,class:"flex align-items-center gap-3"},Me=["alt","src"],Ne={class:"font-bold text-slate-600"},Be={key:1},Le={class:"flex align-items-center gap-3"},Ve=["alt","src"],Ke={class:"font-bold"},Oe={class:"w-full mb-4"},ze={__name:"ApiKey",setup(m){const v=H(),f=$(()=>v.modelList),n=L(1),o=$(()=>f.value.find(l=>l.id===n.value)),h=$(()=>f.value.find(l=>l.id===n.value).key),a={deepseek_local:fe,ollama:pe,tencent:de,baidu:ue,deepseek_office:ce,openai:re,kimi:ie,zhipu:le};return(l,x)=>{const g=ae;return s(),d("div",Se,[w(g,{modelValue:u(n),"onUpdate:modelValue":x[0]||(x[0]=i=>F(n)?n.value=i:null),options:u(f),optionLabel:"name","option-value":"id",class:"w-full md:w-14rem mb-4"},{value:A(i=>[i.value?(s(),d("div",Ae,[e("img",{alt:i.value.label,class:"w-6 h-6 rounded-full",src:u(f).find(y=>y.id===i.value).model_pic},null,8,Me),e("div",Ne,j(u(f).find(y=>y.id===i.value).name),1)])):(s(),d("span",Be,j(i.placeholder),1))]),option:A(i=>[e("div",Le,[e("img",{class:"w-6 h-6 rounded-full",alt:i.option.name,src:i.option.model_pic},null,8,Ve),e("div",Ke,j(i.option.name),1)])]),_:1},8,["modelValue","options"]),e("div",Oe,[(s(),S(K(a[u(h)]),{model:u(o),"model-id":u(n)},null,8,["model","model-id"]))])])}}},Re={class:""},Te={__name:"WhatsNew",emits:["close"],setup(m,{emit:v}){const f=v,n=Q("dialogRef");function o(){f("close"),n.value.close()}return(h,a)=>{const l=O;return s(),d("div",Re,[a[0]||(a[0]=e("div",{class:"text-xl"},"体验你的新版OpenChat！",-1)),a[1]||(a[1]=e("p",null,[e("i",{class:"pi pi-desktop mr-4"}),B("支持多种AI模型接入方式 - DeepSeek-Local(Server)、 Ollama、 云端大模型！")],-1)),a[2]||(a[2]=e("p",null,[e("i",{class:"pi pi-palette mr-4"}),B("提供便捷的AI助手访问方式，满足你多种场景需求！")],-1)),a[3]||(a[3]=e("p",null,[e("i",{class:"pi pi-box mr-4"}),B("我们全力保障你的个人隐私，所有数据均本地存储！")],-1)),w(l,{severity:"contrast",label:"开始对话",onClick:o})])}}},Ee={class:"w-screen h-screen chat shrink grow flex flex-row items-center justify-start overflow-auto bg-neutral-200"},We={class:"w-full py-2 px-4 flex items-center justify-between gap-4 shrink-0 grow-0 flex-nowrap"},Fe={class:"w-full py-2 px-4 flex items-center justify-between gap-4 shrink-0 grow-0 flex-nowrap"},Ue={__name:"Main",setup(m){const v=X(),f=Y(),n=H(),o=se(),h=$(()=>o.conversations),a=$(()=>o.currentConversationId),l=async()=>{console.log("init");try{await x()}catch(b){console.error("Error initializing tables:",b)}},x=async()=>{await o.getConversationList(),h.value.length===0&&(await o.addConversation(),await o.getConversationList()),o.currentConversationId=h.value[0].id};l();const g=$(()=>f.conversationCollapsed);function i(){Promise.allSettled([n.getModelList(),n.getLoadedModel()])}i();function y(){v.open(ze,{props:{header:"添加API Key",modal:!0,style:{width:"600px"}}})}W(()=>{I.on("showApiKeys",y)});function c(){console.log("showWhatsNew"),v.open(Te,{props:{modal:!0,style:{width:"640px"}}})}function t(){const b=localStorage.getItem("hasOpened");console.log(b),b||(localStorage.setItem("hasOpened","true"),c())}t(),W(()=>{I.on("showWhatsNew",c)});const _=q();function r(){_.push({name:"knowledge"})}function p(){_.push({name:"setting"})}return(b,M)=>{const k=O,Z=P("RouterView");return s(),d("div",Ee,[e("div",{class:U(["shrink-0 grow-0 h-full flex flex-col items-start justify-start overflow-hidden transition-all duration-200",u(g)?["w-0"]:["w-[260px]"]])},[M[0]||(M[0]=e("div",{class:"text-2xl text-center w-full font-bold font-sans pt-6 pb-0"},"OpenChat",-1)),w(De,{class:"shrink grow h-full",conversations:u(h),currentConversationId:u(a)},null,8,["conversations","currentConversationId"]),e("div",We,[w(k,{icon:"pi pi-book",class:"w-full shrink grow",severity:"secondary",label:"配置知识库",onClick:r})]),e("div",Fe,[w(k,{icon:"pi pi-key",class:"w-full shrink grow",severity:"secondary",label:"添加API",onClick:y}),w(k,{icon:"pi pi-cog",class:"w-full shrink grow",severity:"secondary",label:"设置",onClick:p})])],2),w(Z,null,{default:A(({Component:z})=>{var R,T;return[(s(),S(ee,null,[(R=b.route)!=null&&R.meta.keepAlive?(s(),S(K(z),{key:0})):V("",!0)],1024)),(T=b.route)!=null&&T.meta.keepAlive?V("",!0):(s(),S(K(z),{key:0}))]}),_:1})])}}},Xe=oe(Ue,[["__scopeId","data-v-567a4b48"]]);export{Xe as default};
