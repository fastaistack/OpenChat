import{a5 as G,u as Q,r as a,A as O,D as W,m as M,o as g,j as y,d as r,a as n,H as X,c as I,x as E,t as k,s as q,b as o,i as P,e as S,a6 as Y,l as N,V as ee,Z as K}from"./index-eE6Y338R.js";import{s as te}from"./fileupload.esm-BmoF79YT.js";import{s as oe}from"./dropdown.esm-D4kKLJT5.js";import{_ as le,f as se}from"./_plugin-vue_export-helper-Dj9PH-fG.js";import{u as A}from"./dayjs.min-BgHgYkuE.js";import{u as ie}from"./Chat-BKqrREEL.js";import{h as ae,j as ne,g as re,n as ce,c as de}from"./knowledge-IEvuAe_Z.js";import{b as ue,a as pe,g as z,f as J}from"./FileIcon-xwz9m_g3.js";import{_ as fe}from"./DocChatConfig-BlSFPeoe.js";import"./inputnumber.esm-0RUmE-GB.js";import"./slider.esm-Dg66TFIy.js";import"./Markdown-D3iSCt8Q.js";import"./card.esm--wyww32T.js";import"./avatar.esm-BsozLR81.js";import"./FileViewer-D4lgJL7i.js";import"./index.esm-CetvORWH.js";const me={class:"flex items-center"},ve=["src"],be={class:"file-title overflow-hidden whitespace-nowrap break-all text-ellipsis max-w-[250px]"},ge={__name:"FileHistory",emits:["selectFile"],setup(Z,{emit:i}){const f=G(),x=Q(),m=A(),d=a([]),u=a(0);function H(t,s){x.require({target:t.currentTarget,message:S("kb.deleteConfirmMsg"),icon:"pi pi-info-circle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-danger p-button-sm",rejectLabel:S("lang.cancel"),acceptLabel:S("kb.delete"),accept:()=>{ne(s.id).then(()=>{f.add({severity:"success",summary:S("kb.success"),detail:S("kb.deleteSuccess"),life:3e3}),v()})}})}let h={page:1,pageSize:10};function $(){m.currentConversationId&&ae({id:m.currentConversationId,page:h.page,pagesize:h.pageSize}).then(t=>{const s=t.resData;d.value=s.data,u.value=s.total})}const _=a(0);function v(){h.page=1,_.value=0,$()}function j(t){h.page=t.page+1,h.pageSize=t.rows,$()}function w(t){const s=z(t);return J(s)}const D=i;function L(t){D("selectFile",t)}return O(()=>{$()}),(t,s)=>{const C=ue,b=q,R=pe,T=W("tooltip");return g(),M(R,{lazy:"",value:o(d),paginator:o(u)>0,first:o(_),"onUpdate:first":s[0]||(s[0]=c=>P(_)?_.value=c:null),rows:10,rowsPerPageOptions:[10,20,30],totalRecords:o(u),stripedRows:"",rowHover:"",resizableColumns:"",dataKey:"id",onPage:j},{paginatorstart:y(()=>s[1]||(s[1]=[])),paginatorend:y(()=>[E(k(t.$t("kb.total"))+" "+k(o(u))+" "+k(t.$t("kb.items")),1)]),default:y(()=>[r(C,{field:"name",header:t.$t("kb.name")},{body:y(({data:c})=>[n("div",me,[n("img",{src:w(c.name),alt:"",style:{width:"25px","margin-right":"5px"}},null,8,ve),X((g(),I("div",be,[E(k(c.name),1)])),[[T,c.name]])])]),_:1},8,["header"]),r(C,{field:"size",header:t.$t("kb.fileSize")},null,8,["header"]),r(C,{field:"createtime",header:t.$t("kb.uploadTime")},null,8,["header"]),r(C,{field:"operation",header:t.$t("kb.operation")},{body:y(c=>[r(b,{label:t.$t("kb.selectFile"),text:"",onClick:e=>L(c.data)},null,8,["label","onClick"]),r(b,{label:t.$t("kb.delete"),text:"",severity:"danger",onClick:e=>H(e,c.data)},null,8,["label","onClick"])]),_:1},8,["header"])]),_:1},8,["value","paginator","first","totalRecords"])}}},he=le(ge,[["__scopeId","data-v-45373339"]]),_e={class:"file-container relative flex flex-col items-start justify-start w-[280px] -left-[28px] top-[50px] cursor-pointer overflow-hidden"},ye={class:"flex justify-start items-center"},ke={class:"text-slate-500 font-bold text-sm"},we={class:"flex mt-2"},Ce={key:0,class:"pi pi-spin pi-spinner mr-1"},Fe={key:1,class:"pi pi-file mr-1"},xe={key:0,class:"flex items-center w-full mt-2 cursor-pointer"},$e=["src"],De={class:"w-52 break-all whitespace-nowrap overflow-hidden text-ellipsis"},Se={class:"ml-4"},qe={__name:"DocChat",setup(Z){const i=a([]),f=a(""),x=a(),m=A(),d=ie(),u=a(!1),H=e=>{const l=new FormData;l.append("id",m.currentConversationId),l.append("name",m.currentConversationId),l.append("knowledge_setting",JSON.stringify({embed_model:b.value})),e.files.length>0?e.files.forEach(p=>{l.append("files",p)}):l.append("files",new File([],"")),u.value=!0,i.value=[],de(l).then(p=>{const U=p.resData;if(f.value=U[0],i.value=e.files,i.value.length>0){const F=i.value[0].name,B=z(F);d.setFileInfo({id:f.value,name:F,type:B})}x.value.clear(),x.value.uploadedFileCount=0,c()}).finally(()=>{u.value=!1})};function h(){const e=i.value[0].name,l=z(e);["txt","html","htm","md","json","jsonl","xml","pdf","docx"].includes(l)&&(d.setFileView(!0),d.setFileInfo({id:f.value,name:i.value[0].name,type:l}))}function $(){_()}function _(){i.value=[],f.value=[],d.setFileView(!1),d.setFileInfo({})}const v=a(!1);function j(e){f.value=e.id,i.value=[{id:e.id,name:e.name,size:e.bytetotal}],d.setFileInfo({id:f.value,name:e.name,type:z(e.name)}),s()}const w=a(!1),D=a(!1);function L(){v.value=!0,K(()=>{w.value=!0})}function t(){v.value=!0,K(()=>{D.value=!0})}function s(){v.value=!1,w.value=!1,D.value=!1}function C(e){const l=z(e);return J(l)}const b=a(""),R=a(!0),T=a([]);function c(){return re().then(async e=>{const l=e.resData;T.value=l,await ce(m.currentConversationId).then(p=>{b.value=p.resData.local_path,R.value=p.resData.is_editable})})}return O(()=>{c().then(()=>{H({files:[]})})}),Y(()=>{d.clearPluginData()}),(e,l)=>{const p=oe,U=te,F=q,B=ee;return g(),I("div",null,[n("div",_e,[n("div",ye,[n("label",ke,k(e.$t("kb.embedModelPath")),1),r(p,{class:"w-[200px] ml-2",modelValue:o(b),"onUpdate:modelValue":l[0]||(l[0]=V=>P(b)?b.value=V:null),options:o(T),optionLabel:"name",optionValue:"local_path",disabled:!o(R)},null,8,["modelValue","options","disabled"])]),n("div",we,[r(U,{mode:"basic",name:"uploader",ref_key:"uploaderRef",ref:x,url:"",accept:".pdf,.docx,.txt,.html,.htm,.md,.json,.jsonl,.epub,.mobi,.xml,.pptx","choose-label":e.$t("kb.selectFile"),"upload-icon":"pi pi-file",maxFileSize:500*1024*1024,auto:"",customUpload:"",onUploader:H,onSelect:$,disabled:o(u),pt:{chooseButton:{class:"p-button-text"}}},{uploadicon:y(()=>[o(u)?(g(),I("i",Ce)):(g(),I("i",Fe))]),_:1},8,["choose-label","disabled"]),n("div",null,[r(F,{icon:"pi pi-clock",text:"",label:e.$t("kb.fileHistory"),onClick:L},null,8,["label"]),r(F,{text:"",onClick:t,label:e.$t("lang.config")},null,8,["label"])])]),o(i).length>0?(g(),I("div",xe,[n("img",{src:C(o(i)[0].name),alt:"",style:{width:"35px","margin-right":"5px"}},null,8,$e),n("div",{onClick:h},[n("div",De,k(o(i)[0].name),1),n("div",null,k(o(se)(o(i)[0].size)),1)]),n("div",Se,[r(F,{icon:"pi pi-times",onClick:l[1]||(l[1]=V=>_()),rounded:"",text:"",severity:"danger"})])])):N("",!0)]),r(B,{visible:o(v),"onUpdate:visible":l[2]||(l[2]=V=>P(v)?v.value=V:null),modal:"",header:o(w)?e.$t("kb.fileHistory"):e.$t("lang.config"),class:"w-2/5 min-w-[600px]",onHide:s},{default:y(()=>[o(w)?(g(),M(he,{key:0,ref:"fileHistoryRef",onSelectFile:j,onHide:s},null,512)):N("",!0),o(D)?(g(),M(fe,{key:1,ref:"docChatConfigRef",kbId:o(m).currentConversationId,sessionId:o(m).currentConversationId,type:"chat_files_retrievers",onSuccess:s,onHide:s},null,8,["kbId","sessionId"])):N("",!0)]),_:1},8,["visible","header"])])}}};export{qe as default};
